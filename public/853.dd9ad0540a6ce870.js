"use strict";(self.webpackChunkimperial=self.webpackChunkimperial||[]).push([[853],{2853:(ht,R,c)=>{c.r(R),c.d(R,{ClientsModule:()=>gt});var k=c(9562),l=c(5030),H=c(6356),e=c(2223);let K=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[l.u5,H.A,l.UX]}),t})();var U=c(5861),Q=c(512),I=c(3627),B=c(2611),D=c(2534),W=c(9025),X=c(5226),Y=c.n(X),E=c(6081),$=c(5497),J=c(7066),j=c(9089),P=c(6550),w=c(4755),L=c(1576);let ee=(()=>{class t{constructor(i){this.sanitizer=i}transform(i,a){return this.sanitizer.bypassSecurityTrustResourceUrl(i)}}return t.\u0275fac=function(i){return new(i||t)(e.Y36(P.H7,16))},t.\u0275pipe=e.Yjl({name:"safe",type:t,pure:!0}),t})();const te=["searchInput"];function ie(t,r){1&t&&(e.TgZ(0,"mat-header-cell",39)(1,"span",40),e._uU(2,"Detalles"),e.qZA()())}function ne(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"mat-cell",39)(1,"span",40)(2,"button",41),e.NdJ("click",function(){const m=e.CHM(i).$implicit,b=e.oxw();return e.KtG(b.openDetails(m))}),e._UZ(3,"span",42),e.qZA()()()}}function ae(t,r){1&t&&(e.TgZ(0,"mat-header-cell",43)(1,"span",40),e._uU(2,"Nombre completo"),e.qZA()())}function re(t,r){if(1&t&&(e.TgZ(0,"mat-cell",43)(1,"span",44),e._uU(2),e.qZA()()),2&t){const i=r.$implicit;e.xp6(2),e.Oqu(i.fullname)}}function oe(t,r){1&t&&(e.TgZ(0,"mat-header-cell",45)(1,"span",40),e._uU(2,"Sistema"),e.qZA()())}function le(t,r){1&t&&e._UZ(0,"span",48)}function se(t,r){1&t&&e._UZ(0,"span",49)}function ce(t,r){if(1&t&&(e.TgZ(0,"mat-cell",45)(1,"span",40),e.YNc(2,le,1,0,"span",46),e.YNc(3,se,1,0,"span",47),e.qZA()()),2&t){const i=r.$implicit;e.xp6(2),e.Q6J("ngIf",i.isLogged),e.xp6(1),e.Q6J("ngIf",!i.isLogged)}}function de(t,r){1&t&&(e.TgZ(0,"mat-header-cell",45)(1,"span",40),e._uU(2,"Puntos"),e.qZA()())}function me(t,r){if(1&t&&(e.TgZ(0,"mat-cell",45)(1,"span",40)(2,"span",44),e._uU(3),e.qZA()()()),2&t){const i=r.$implicit;e.xp6(3),e.Oqu(i.points)}}function pe(t,r){1&t&&(e.TgZ(0,"mat-header-cell",43)(1,"span",40),e._uU(2,"Tel\xe9fono"),e.qZA()())}function ue(t,r){if(1&t&&(e.TgZ(0,"mat-cell",43)(1,"span",44),e._uU(2),e.qZA()()),2&t){const i=r.$implicit;e.xp6(2),e.Oqu(i.phoneNumber)}}function ge(t,r){1&t&&(e.TgZ(0,"mat-header-cell",50)(1,"span",40),e._uU(2,"Ubicaci\xf3n"),e.qZA()())}function fe(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"mat-cell",50)(1,"span",40)(2,"button",51),e.NdJ("click",function(){const m=e.CHM(i).$implicit,b=e.oxw(),q=e.MAs(49);return e.KtG(b.openModal(q,m.geolocation))}),e._UZ(3,"span",52),e.qZA()()()}}function he(t,r){1&t&&e._UZ(0,"mat-header-row",53)}function ve(t,r){1&t&&e._UZ(0,"mat-row",54)}function _e(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div",55)(1,"h5",56),e._uU(2,"Ubicaci\xf3n"),e.qZA(),e.TgZ(3,"button",57),e.NdJ("click",function(){const m=e.CHM(i).$implicit;return e.KtG(m.close())}),e.qZA()(),e.TgZ(4,"div",58),e._UZ(5,"iframe",59),e.ALo(6,"safe"),e.qZA(),e.TgZ(7,"div",60)(8,"button",61),e.NdJ("click",function(){const m=e.CHM(i).$implicit;return e.KtG(m.close())}),e._uU(9,"Cerrar"),e.qZA()()}if(2&t){const i=e.oxw();e.xp6(5),e.Q6J("src",e.lcZ(6,1,i.mapsURL),e.uOi)}}let Ce=(()=>{class t{constructor(i,a,o,m,b,q){var T=this;this.ngxUiLoaderService=i,this.clientsService=a,this.dataService=o,this.modalService=m,this.titleService=b,this.router=q,this.mapsURL="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d127493.98656362396!2d-60.04967500122291!3d-3.044487471110905!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x926c1bc8b37647b7%3A0x2b485c9ff765a9cc!2sManaos%2C%20Amazonas%2C%20Brasil!5e0!3m2!1ses-419!2scl!4v1689376182238!5m2!1ses-419!2scl",this.pagination={},this.totalElements=0,this.pageSizeOptions=W.X.pageSizeOptions,this.displayedColumns=["details","fullname","points","system","phoneNumber","location"],this.redirect=(v="")=>{this.router.navigate(""!==v?[`${v}`]:[D.f.routes.dash])},this.initPagination=()=>{this.pagination.offset=0,this.pagination.limit=this.defPagination,this.pagination.filter=""},this.dataLoad=(0,U.Z)(function*(){T.ngxUiLoaderService.startLoader("loader-02");try{const v=yield T.clientsService.findActives(T.pagination);v.data&&(T.dataSource=new I.by(v.data),T.totalElements=v.count,T.dataSource.sort=T.sort)}catch(v){T.dataService.errorHandling(v)}finally{T.ngxUiLoaderService.stopLoader("loader-02")}}),this.nextPage=v=>{const{pageSize:s,pageIndex:_}=v;this.dataService.setSelectedPagination(s),this.defPagination=this.dataService.getSelectedPagination(),this.pagination.offset=this.defPagination*_,this.pagination.limit=s,this.dataLoad()},this.searchElement=(v=!1)=>{try{this.pagination.filter=this.searchInput.nativeElement.value,v&&(this.paginator&&this.paginator.firstPage(),this.pagination.offset=0,this.dataLoad())}catch(s){this.dataService.errorHandling(s)}},this.openDetails=v=>{this.dataService.setExistClient(v),this.redirect(D.f.routes.clientsDetail)},this.user=this.dataService.getLoggedUser(),(!this.dataService.getIsLoggedIn()||!this.user)&&(this.dataService.clearLoginData(),this.redirect(D.f.routes.login))}ngOnInit(){this.titleService.setTitle("SISTEMA IMPERIAL | Clientes activos"),this.defPagination=this.dataService.getSelectedPagination(),this.initPagination(),this.dataLoad()}openModal(i,a){const o=a.longitude,m=a.latitude;0!==o&&0!==m?(this.mapsURL=`https://www.google.com/maps/embed/v1/place?key=AIzaSyA2JmkNSOr1eP7UgOkB8faxG8jC7q4EnBE&q=${m},${o}`,this.modalService.open(i,{centered:!0}).result.then(()=>{this.mapsURL=""}).catch(b=>{this.mapsURL=""})):Y().fire({title:"<strong>Sin datos de ubicaci\xf3n</strong>",html:'<div class="card"><div class="card-body"><p>\n            El cliente no posee datos de ubicaci\xf3n.<br>\n            Es necesario que otorgue permisos de ubicaci\xf3n para usar esta funcionalidad.\n          </p></div></div>',showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})}}return t.\u0275fac=function(i){return new(i||t)(e.Y36(E.LA),e.Y36($.a),e.Y36(J.D),e.Y36(j.FF),e.Y36(P.Dx),e.Y36(k.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-clients-actives"]],viewQuery:function(i,a){if(1&i&&(e.Gf(Q.NW,7),e.Gf(B.YE,7),e.Gf(te,5)),2&i){let o;e.iGM(o=e.CRH())&&(a.paginator=o.first),e.iGM(o=e.CRH())&&(a.sort=o.first),e.iGM(o=e.CRH())&&(a.searchInput=o.first)}},decls:50,vars:7,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/admin/dashboard"],[1,"feather","icon-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"d-flex","align-items-center","flex-wrap","text-nowrap"],[1,"input-group","me-2","mb-2"],["name","searchInput","placeholder","Buscar",1,"form-control",2,"border-top-left-radius","1rem !important","border-bottom-left-radius","1rem !important","margin-left","0.5em","margin-right","0.5em"],["searchInput",""],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"feather","icon-search"],[1,"col-md-12","stretch-card"],[1,"card","card-table"],[1,"card-body"],[2,"overflow-x","auto !important"],[1,"table-responsive"],["matSort","",1,"common-table",3,"dataSource"],["table",""],["matColumnDef","details"],["fxFlex","auto 1 100px",4,"matHeaderCellDef"],["fxFlex","auto 1 100px",4,"matCellDef"],["matColumnDef","fullname"],["fxFlex","auto 1 200px",4,"matHeaderCellDef"],["fxFlex","auto 1 200px",4,"matCellDef"],["matColumnDef","system"],["fxFlex","auto 1",4,"matHeaderCellDef"],["fxFlex","auto 1",4,"matCellDef"],["matColumnDef","points"],["matColumnDef","phoneNumber"],["matColumnDef","location"],["fxFlex","auto 1 150px",4,"matHeaderCellDef"],["fxFlex","auto 1 150px",4,"matCellDef"],["class","grey-400-bg font-weight-600",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","user","matRipple","",4,"matRowDef","matRowDefColumns"],[3,"length","pageSizeOptions","pageSize","page"],["paginator",""],["verticalCenteredModal",""],["fxFlex","auto 1 100px"],[2,"margin","0","text-align","center","width","100%"],["type","button","aria-label","remove",1,"btn","btn-primary","btn-icon",3,"click"],[1,"feather","icon-eye","active-icon"],["fxFlex","auto 1 200px"],[2,"margin","0","text-align","left","padding-left","10px","width","100%"],["fxFlex","auto 1"],["class","feather icon-log-in active-icon","style","color: green; background-color: white; padding: 5px;",4,"ngIf"],["class","feather icon-x active-icon","style","color: red; background-color: white; padding: 5px;",4,"ngIf"],[1,"feather","icon-log-in","active-icon",2,"color","green","background-color","white","padding","5px"],[1,"feather","icon-x","active-icon",2,"color","red","background-color","white","padding","5px"],["fxFlex","auto 1 150px"],["type","button","aria-label","remove",1,"btn","btn-danger","btn-icon",3,"click"],[1,"feather","icon-map-pin","active-icon"],[1,"grey-400-bg","font-weight-600"],["matRipple","",1,"user"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["width","100%","height","315","frameborder","0","allowfullscreen","","webkitallowfullscreen","","mozallowfullscreen","","loading","lazy","allowfullscreen","","referrerpolicy","no-referrer-when-downgrade",2,"border","0",3,"src"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(i,a){1&i&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2)(3,"a",3),e._UZ(4,"span",4),e.qZA()(),e.TgZ(5,"li",2),e._uU(6,"Contratos"),e.qZA(),e.TgZ(7,"li",2),e._uU(8,"Clientes"),e.qZA(),e.TgZ(9,"li",5),e._uU(10,"Activos"),e.qZA()()(),e.TgZ(11,"div",6)(12,"div",7)(13,"div",8),e._UZ(14,"input",9,10),e.TgZ(16,"button",11),e.NdJ("click",function(){return a.searchElement(!0)}),e._UZ(17,"span",12),e.qZA()()()(),e.TgZ(18,"div",6)(19,"div",13)(20,"div",14)(21,"div",15)(22,"div",16)(23,"div",17)(24,"mat-table",18,19),e.ynx(26,20),e.YNc(27,ie,3,0,"mat-header-cell",21),e.YNc(28,ne,4,0,"mat-cell",22),e.BQk(),e.ynx(29,23),e.YNc(30,ae,3,0,"mat-header-cell",24),e.YNc(31,re,3,1,"mat-cell",25),e.BQk(),e.ynx(32,26),e.YNc(33,oe,3,0,"mat-header-cell",27),e.YNc(34,ce,4,2,"mat-cell",28),e.BQk(),e.ynx(35,29),e.YNc(36,de,3,0,"mat-header-cell",27),e.YNc(37,me,4,1,"mat-cell",28),e.BQk(),e.ynx(38,30),e.YNc(39,pe,3,0,"mat-header-cell",24),e.YNc(40,ue,3,1,"mat-cell",25),e.BQk(),e.ynx(41,31),e.YNc(42,ge,3,0,"mat-header-cell",32),e.YNc(43,fe,4,0,"mat-cell",33),e.BQk(),e.YNc(44,he,1,0,"mat-header-row",34),e.YNc(45,ve,1,0,"mat-row",35),e.qZA()()(),e.TgZ(46,"mat-paginator",36,37),e.NdJ("page",function(m){return a.nextPage(m)}),e.qZA()()()()(),e.YNc(48,_e,10,3,"ng-template",null,38,e.W1O)),2&i&&(e.xp6(24),e.Q6J("dataSource",a.dataSource),e.xp6(20),e.Q6J("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky","true"),e.xp6(1),e.Q6J("matRowDefColumns",a.displayedColumns),e.xp6(1),e.Q6J("length",a.totalElements)("pageSizeOptions",a.pageSizeOptions)("pageSize",a.defPagination))},dependencies:[k.rH,w.O5,B.YE,Q.NW,I.BZ,I.fO,I.as,I.w1,I.Dz,I.nj,I.ge,I.ev,I.XQ,I.Gk,L.yH,ee]}),t})();var V=c(6811),xe=c(5170),G=c(4074),O=c(5580);function Ze(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div")(1,"div",14)(2,"label",35),e._uU(3,"CPF"),e.qZA(),e.TgZ(4,"input",36),e.NdJ("focusout",function(o){e.CHM(i);const m=e.oxw();return e.KtG(m.findClient(o))}),e.qZA()()()}}function be(t,r){if(1&t&&(e.TgZ(0,"div")(1,"div",14)(2,"span")(3,"b"),e._uU(4,"CPF:"),e.qZA(),e._uU(5),e.qZA(),e._UZ(6,"br"),e.qZA()()),2&t){const i=e.oxw();e.xp6(5),e.hij(" ",i.elementForm.getRawValue().cpf,"")}}function ye(t,r){1&t&&(e.TgZ(0,"p",46),e._UZ(1,"span",47),e.qZA())}function Ae(t,r){if(1&t&&e._UZ(0,"img",48),2&t){const i=e.oxw(2);e.Q6J("src",i.clientImage,e.LSH)}}function Te(t,r){1&t&&(e.TgZ(0,"p",46),e._UZ(1,"span",4),e.qZA())}function Ue(t,r){if(1&t&&e._UZ(0,"img",49),2&t){const i=e.oxw(2);e.Q6J("src",i.placeImage,e.LSH)}}function De(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"div",37)(3,"div",38)(4,"div",9)(5,"div",10)(6,"h6",11),e._uU(7,"Cliente"),e.qZA(),e.YNc(8,ye,2,0,"p",39),e.YNc(9,Ae,1,1,"img",40),e.qZA(),e.TgZ(10,"div",41)(11,"div",42)(12,"a",43),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.openCamera("client"))}),e._UZ(13,"span",44),e.qZA()()()()(),e.TgZ(14,"div",38)(15,"div",9)(16,"div",10)(17,"h6",11),e._uU(18,"Direcci\xf3n"),e.qZA(),e.YNc(19,Te,2,0,"p",39),e.YNc(20,Ue,1,1,"img",45),e.qZA(),e.TgZ(21,"div",41)(22,"div",42)(23,"a",43),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.openCamera("place"))}),e._UZ(24,"span",44),e.qZA()()()()()()()}if(2&t){const i=e.oxw();e.xp6(8),e.Q6J("ngIf",!i.clientImage),e.xp6(1),e.Q6J("ngIf",i.clientImage),e.xp6(10),e.Q6J("ngIf",!i.placeImage),e.xp6(1),e.Q6J("ngIf",i.placeImage)}}function Ie(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(o){e.CHM(i);const m=e.oxw();return e.KtG(m.resetPassword(o))}),e._uU(1,"Reiniciar contrase\xf1a"),e.qZA()}}let qe=(()=>{class t{constructor(i,a,o,m,b,q,T,v){var s=this;this.ngxUiLoaderService=i,this.clientsService=a,this.imagesService=o,this.dataService=m,this.formBuilder=b,this.matDialog=q,this.location=T,this.router=v,this.userToEdit=null,this.type="create",this.clientImage=null,this.placeImage=null,this.createForm=()=>this.formBuilder.group({cpf:["",l.kI.required],name:["",l.kI.required],lastname:["",l.kI.required],gender:["",l.kI.required],residence:["",l.kI.required],work:["",l.kI.required],phone:["",l.kI.required],email:["",l.kI.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$")]}),this.patchForm=()=>{this.elementForm.patchValue({cpf:this.userToEdit?this.userToEdit.cpf:"",name:this.userToEdit?this.userToEdit.firstName:"",lastname:this.userToEdit?this.userToEdit.paternalSurname:"",gender:this.userToEdit?this.userToEdit.gender:"",residence:this.userToEdit?this.userToEdit.residenceAddress:"",work:this.userToEdit?this.userToEdit.billingAddress:"",phone:this.userToEdit?this.userToEdit.phoneNumber:"",email:this.userToEdit?this.userToEdit.email:"cliente@imperial.pronto"}),this.userToEdit&&this.elementForm.controls.cpf.disable()},this.redirect=(_="")=>{this.router.navigate(""!==_?[`${_}`]:[D.f.routes.dash])},this.createClient=function(){var _=(0,U.Z)(function*(y){s.ngxUiLoaderService.startLoader("loader-02"),y.preventDefault();const n=s.elementForm.getRawValue(),{cpf:d,name:p,lastname:u,gender:h,residence:g,work:f,phone:C,email:x}=n;try{if(""!==d){const Z=yield s.clientsService.clientExist(d),{exist:F}=Z;if(F)return void s.clientExist(Z)}if(x.length&&!xe.G.isValidEmail(x))return s.dataService.errorHandling({front:!0,message:"La direcci\xf3n de correo no es v\xe1lida, verifique e intente nuevamente."}),void s.ngxUiLoaderService.stopLoader("loader-02");if(s.userToEdit)yield s.clientsService.updateUser(s.userToEdit.id,{email:x,firstName:p.toLowerCase(),paternalSurname:u.toLowerCase(),residenceAddress:g,billingAddress:f,phoneNumber:C,profilePicture:s.clientImage?s.clientImage:"",addressPicture:s.placeImage?s.placeImage:"",gender:h}),s.dataService.clearCreatedUser(),s.location.back();else{let Z=null,F=null;if(!s.clientImage)return void s.dataService.errorHandling({front:!0,message:"La imagen del cliente es obligatoria, verifique e intente nuevamente."});if(Z=yield s.imagesService.createImage({base64:s.clientImage,type:"client"}),!s.placeImage)return void s.dataService.errorHandling({front:!0,message:"La imagen de la direcci\xf3n es obligatoria, verifique e intente nuevamente."});F=yield s.imagesService.createImage({base64:s.placeImage,type:"direction"});const A=yield s.clientsService.createUser({cpf:d.toLowerCase().trim(),email:x,firstName:p.toLowerCase(),paternalSurname:u.toLowerCase(),residenceAddress:g,billingAddress:f,phoneNumber:C,profilePicture:Z?Z.id:"",addressPicture:F?F.id:"",gender:h});422===A?.status?(s.dataService.setExistClient(A.data?.user),s.redirect(D.f.routes.clientsDetail)):(s.dataService.setCreatedUser(A),s.redirect(D.f.routes.contractsCreate))}}catch(Z){404!==Z.status&&s.dataService.errorHandling(Z)}finally{s.ngxUiLoaderService.stopLoader("loader-02")}});return function(y){return _.apply(this,arguments)}}(),this.resetPassword=function(){var _=(0,U.Z)(function*(y){try{y.preventDefault(),s.userToEdit&&(yield s.clientsService.resetUserPassword(s.userToEdit.id)),s.dataService.clearCreatedUser(),s.redirect(D.f.routes.configWorkers)}catch(n){s.dataService.errorHandling(n)}finally{s.ngxUiLoaderService.stopLoader("loader-02")}});return function(y){return _.apply(this,arguments)}}(),this.clientExist=_=>{Y().fire({title:"\xa1El cliente ya est\xe1 registrado!",text:"El CPF ingresado ya existe en nuestros registros. \xbfDesea continuar con otro CPF o ir a los datos del cliente?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a los datos del cliente",cancelButtonText:"Continuar"}).then(y=>{y.isConfirmed?(this.dataService.setExistClient(_),this.redirect(D.f.routes.clientsDetail)):this.elementForm.patchValue({cpf:""})})},this.findClient=function(){var _=(0,U.Z)(function*(y){try{const n=y.target.value;if(""!==n){const d=yield s.clientsService.findClient(n);d&&s.clientExist(d)}}catch(n){404!==n.status&&s.dataService.errorHandling(n)}});return function(y){return _.apply(this,arguments)}}(),this.openCamera=_=>{this.cameraDialogRef=this.matDialog.open(V.M,{autoFocus:!0,disableClose:!0,height:"90vh",minWidth:"95vw"}),this.cameraDialogRef.afterClosed().subscribe(function(){var y=(0,U.Z)(function*(n){if(n)switch(_){case"client":s.clientImage=n;break;case"place":s.placeImage=n}s.cameraDialogRef=null});return function(n){return y.apply(this,arguments)}}())}}ngOnInit(){this.userToEdit=this.dataService.getCreatedUser()??null,this.userToEdit?this.type="edit":this.dataService.clearCreatedUser(),this.elementForm=this.createForm(),this.patchForm()}}return t.\u0275fac=function(i){return new(i||t)(e.Y36(E.LA),e.Y36($.a),e.Y36(G.C),e.Y36(J.D),e.Y36(l.qu),e.Y36(O.uw),e.Y36(w.Ye),e.Y36(k.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-clients-create"]],decls:59,vars:8,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/admin/dashboard"],[1,"feather","icon-home"],["routerLink","/admin/clients/actives"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"col-md-12","stretch-card"],[1,"card"],[1,"card-body"],[1,"card-title"],["name","elementForm","novalidate","",3,"formGroup"],[4,"ngIf"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name","autocomplete","off","required","",1,"form-control"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","autocomplete","off","required","",1,"form-control"],["for","gender",1,"form-label"],["id","gender","formControlName","gender","required","",1,"form-select"],["value","male","selected",""],["value","female"],["for","residence",1,"form-label"],["type","text","id","residence","formControlName","residence","autocomplete","off","required","",1,"form-control"],["for","work",1,"form-label"],["type","text","id","work","formControlName","work","autocomplete","off","required","",1,"form-control"],["for","phone",1,"form-label"],["type","text","id","phone","appInputRestriction","int","oninput","this.value=this.value.replace(/[^0-9]/g,'')","formControlName","phone","autocomplete","off","required","",1,"form-control"],["for","email",1,"form-label"],["type","text","id","email","formControlName","email","autocomplete","off",1,"form-control"],["fxLayout","row","fxLayoutAlign","space-between"],["class","btn btn-primary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"btn","btn-secondary",3,"routerLink","click"],["for","cpf",1,"form-label"],["type","text","id","cpf","appInputRestriction","int","oninput","this.value=this.value.replace(/[^0-9]/g,'')","formControlName","cpf","autocomplete","off","required","",1,"form-control",3,"focusout"],[1,"row","justify-content-md-center"],[1,"col-6","col-md-3"],["class","card-text mb-3","style","font-size: 3.5em; text-align: center;",4,"ngIf"],["class","profile-image card-img-top","title","clientImage","style","margin: 0 auto;",3,"src",4,"ngIf"],[1,"card-footer"],[1,"d-grid","gap-2"],["href","","href","javascript:void(0)",1,"btn","btn-primary",3,"click"],[1,"feather","icon-camera"],["class","profile-image card-img-top","title","placeImage","style","margin: 0 auto;",3,"src",4,"ngIf"],[1,"card-text","mb-3",2,"font-size","3.5em","text-align","center"],[1,"feather","icon-user"],["title","clientImage",1,"profile-image","card-img-top",2,"margin","0 auto",3,"src"],["title","placeImage",1,"profile-image","card-img-top",2,"margin","0 auto",3,"src"],[1,"btn","btn-primary",3,"click"]],template:function(i,a){1&i&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2)(3,"a",3),e._UZ(4,"span",4),e.qZA()(),e.TgZ(5,"li",2)(6,"a",5),e._uU(7,"Clientes"),e.qZA()(),e.TgZ(8,"li",6),e._uU(9),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"h6",11),e._uU(15,"Registro"),e.qZA(),e.TgZ(16,"form",12),e.YNc(17,Ze,5,0,"div",13),e.YNc(18,be,7,1,"div",13),e.TgZ(19,"div",14)(20,"label",15),e._uU(21,"Nombre"),e.qZA(),e._UZ(22,"input",16),e.qZA(),e.TgZ(23,"div",14)(24,"label",17),e._uU(25,"Apellido"),e.qZA(),e._UZ(26,"input",18),e.qZA(),e.TgZ(27,"div",14)(28,"label",19),e._uU(29,"Sexo"),e.qZA(),e.TgZ(30,"select",20)(31,"option",21),e._uU(32,"Hombre"),e.qZA(),e.TgZ(33,"option",22),e._uU(34,"Mujer"),e.qZA()()(),e.TgZ(35,"div",14)(36,"label",23),e._uU(37,"Direcci\xf3n residencial"),e.qZA(),e._UZ(38,"input",24),e.qZA(),e.TgZ(39,"div",14)(40,"label",25),e._uU(41,"Direcci\xf3n de cobro"),e.qZA(),e._UZ(42,"input",26),e.qZA(),e.TgZ(43,"div",14)(44,"label",27),e._uU(45,"N\xfamero de tel\xe9fono"),e.qZA(),e._UZ(46,"input",28),e.qZA(),e.TgZ(47,"div",14)(48,"label",29),e._uU(49,"E-Mail"),e.qZA(),e._UZ(50,"input",30),e.qZA(),e.YNc(51,De,25,4,"div",13),e._UZ(52,"hr"),e.TgZ(53,"div",31),e.YNc(54,Ie,2,0,"button",32),e.TgZ(55,"button",33),e.NdJ("click",function(m){return a.createClient(m)}),e._uU(56,"Aceptar"),e.qZA(),e.TgZ(57,"button",34),e.NdJ("click",function(){return!1}),e._uU(58,"Cancelar"),e.qZA()()()()()()()),2&i&&(e.xp6(9),e.hij("","edit"===a.type?"Editar":"Registrar"," cliente"),e.xp6(7),e.Q6J("formGroup",a.elementForm),e.xp6(1),e.Q6J("ngIf","create"===a.type),e.xp6(1),e.Q6J("ngIf","edit"===a.type),e.xp6(33),e.Q6J("ngIf","create"===a.type),e.xp6(3),e.Q6J("ngIf","edit"===a.type),e.xp6(1),e.Q6J("disabled",a.elementForm.invalid),e.xp6(2),e.Q6J("routerLink","/admin/dashboard"))},dependencies:[k.rH,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.Q7,w.O5,L.xw,L.Wh,l.sg,l.u]}),t})();var z=c(7317),Se=c(7228),N=c(1764),we=c(821),Fe=c(4255),Ne=c(5911),ke=c(7552),Ye=c(7778),Le=c(2417),Je=c(274),Ee=c(1545),Pe=c(5268),Me=c(8405),Re=c(3144);let He=(()=>{class t extends J.D{constructor(i){var a;super(),a=this,this.http=i,this.createPayment=function(){var o=(0,U.Z)(function*(m,b){return a.http.post(`${a.getApiUrl()}/payments`,{payments:m,geolocation:b},{headers:a.getHeaders()}).toPromise()});return function(m,b){return o.apply(this,arguments)}}(),this.createMovement=function(){var o=(0,U.Z)(function*(m,b,q){return a.http.post(`${a.getApiUrl()}/payments`,{movementDto:m,geolocation:b,contractData:q},{headers:a.getHeaders()}).toPromise()});return function(m,b,q){return o.apply(this,arguments)}}()}}return t.\u0275fac=function(i){return new(i||t)(e.Y36(Re.eN))},t.\u0275dir=e.lG2({type:t,features:[e.qOj]}),t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Qe=c(5829),Be=c(9476);function $e(t,r){1&t&&(e.TgZ(0,"a"),e._UZ(1,"span",14),e.qZA())}function je(t,r){1&t&&(e.TgZ(0,"a",15),e._UZ(1,"span",14),e.qZA())}function Ve(t,r){1&t&&(e.TgZ(0,"a"),e._uU(1,"Clientes"),e.qZA())}function Ge(t,r){1&t&&(e.TgZ(0,"a",16),e._uU(1,"Clientes"),e.qZA())}const Oe=function(){return{"background-color":"primary"}};function ze(t,r){if(1&t&&(e.TgZ(0,"div",17)(1,"span",18),e._uU(2),e.qZA()()),2&t){const i=e.oxw();e.Q6J("ngStyle",e.DdM(2,Oe)),e.xp6(2),e.hij(" ",i.elementForm.getRawValue().name," ")}}function Ke(t,r){if(1&t&&(e.TgZ(0,"div")(1,"span")(2,"b"),e._uU(3,"Bonos por cliente:"),e.qZA(),e._uU(4),e.qZA(),e._UZ(5,"br"),e.TgZ(6,"span")(7,"b"),e._uU(8,"Clientes referidos:"),e.qZA(),e._uU(9),e.TgZ(10,"a",22),e.NdJ("click",function(){return!1}),e._UZ(11,"span",23),e.qZA()(),e._UZ(12,"br"),e.qZA()),2&t){const i=e.oxw(2);e.xp6(4),e.hij(" ",i.elementForm.getRawValue().bonds,""),e.xp6(5),e.hij(" ",i.elementForm.getRawValue().refers," ")}}function We(t,r){if(1&t&&(e.TgZ(0,"span")(1,"b"),e._uU(2,"Fecha del contrato:"),e.qZA(),e._uU(3),e._UZ(4,"br"),e.qZA()),2&t){const i=e.oxw(2);e.xp6(3),e.hij(" ",i.elementForm.getRawValue().lastContractDate,"")}}function Xe(t,r){if(1&t&&(e.TgZ(0,"span")(1,"b"),e._uU(2,"Cliente registrado por:"),e.qZA(),e._uU(3),e._UZ(4,"br"),e.qZA()),2&t){const i=e.oxw(2);e.xp6(3),e.hij(" ",i.elementForm.getRawValue().createdBy||"","")}}function et(t,r){if(1&t&&(e.TgZ(0,"span")(1,"b"),e._uU(2,"Contrato registrado por:"),e.qZA(),e._uU(3),e._UZ(4,"br"),e.qZA()),2&t){const i=e.oxw(2);e.xp6(3),e.hij(" ",(null==i.lastContract||null==i.lastContract.createdBy?null:i.lastContract.createdBy.getFullName())||"","")}}function tt(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div")(1,"div",19)(2,"div",7)(3,"div",20)(4,"img",21),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.openImage("client"))}),e.qZA()(),e.TgZ(5,"div",20)(6,"img",21),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.openImage("address"))}),e.qZA()()()(),e._UZ(7,"hr"),e.TgZ(8,"div",19)(9,"span")(10,"b"),e._uU(11,"CPF:"),e.qZA(),e._uU(12),e.qZA(),e._UZ(13,"br"),e.TgZ(14,"span")(15,"b"),e._uU(16,"Nombre:"),e.qZA(),e._uU(17),e.qZA(),e._UZ(18,"br"),e.TgZ(19,"span")(20,"b"),e._uU(21,"Direcci\xf3n residencial:"),e.qZA(),e._uU(22),e.qZA(),e._UZ(23,"br"),e.TgZ(24,"span")(25,"b"),e._uU(26,"N\xfamero de Tel\xe9fono:"),e.qZA(),e._uU(27),e.qZA(),e._UZ(28,"br"),e.YNc(29,Ke,13,2,"div",3),e.TgZ(30,"span")(31,"b"),e._uU(32,"N\xfamero de contratos:"),e.qZA(),e._uU(33),e.qZA(),e._UZ(34,"br"),e.TgZ(35,"span")(36,"b"),e._uU(37,"Puntos del cliente:"),e.qZA(),e._uU(38),e.qZA(),e._UZ(39,"br"),e.YNc(40,We,5,1,"span",3),e.YNc(41,Xe,5,1,"span",3),e.YNc(42,et,5,1,"span",3),e.qZA()()}if(2&t){const i=e.oxw();e.xp6(4),e.Q6J("src",i.profilePicture,e.LSH),e.xp6(2),e.Q6J("src",i.addressPicture,e.LSH),e.xp6(6),e.hij(" ",i.elementForm.getRawValue().cpf,""),e.xp6(5),e.hij(" ",i.elementForm.getRawValue().name,""),e.xp6(5),e.hij(" ",i.elementForm.getRawValue().residence,""),e.xp6(5),e.hij(" ",i.elementForm.getRawValue().phone,""),e.xp6(2),e.Q6J("ngIf",i.activeBonus),e.xp6(4),e.hij(" ",i.elementForm.getRawValue().countContracts,""),e.xp6(5),e.hij(" ",i.elementForm.getRawValue().points,""),e.xp6(2),e.Q6J("ngIf",i.haveContracts),e.xp6(1),e.Q6J("ngIf",!i.isClient),e.xp6(1),e.Q6J("ngIf",i.haveContracts)}}function it(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div",25),e._UZ(1,"hr"),e.TgZ(2,"button",26),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.createContract())}),e._uU(3,"Registrar contrato"),e.qZA()()}}function nt(t,r){if(1&t&&(e.TgZ(0,"div")(1,"span"),e._uU(2,"El cliente no posee contratos"),e.qZA(),e.YNc(3,it,4,0,"div",24),e.qZA()),2&t){const i=e.oxw();e.xp6(3),e.Q6J("ngIf",!i.isClient)}}function at(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div",25),e._UZ(1,"hr"),e.TgZ(2,"button",26),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.createContract())}),e._uU(3,"Registrar contrato"),e.qZA()()}}function rt(t,r){if(1&t&&(e.TgZ(0,"div")(1,"span"),e._uU(2,"El cliente no posee contratos activos"),e.qZA(),e.YNc(3,at,4,0,"div",24),e.qZA()),2&t){const i=e.oxw();e.xp6(3),e.Q6J("ngIf",!i.isClient)}}function ot(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div",57)(1,"img",21),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(3);return e.KtG(o.openImage("payment"))}),e.qZA()()}if(2&t){const i=e.oxw(3);e.xp6(1),e.Q6J("src",i.paymentImage,e.LSH)}}function lt(t,r){1&t&&(e.TgZ(0,"div",7)(1,"div",58)(2,"button",26),e.NdJ("click",function(){return!1}),e._uU(3,"Usar puntos"),e.qZA()(),e.TgZ(4,"div",59)(5,"button",26),e.NdJ("click",function(){return!1}),e._uU(6,"Usar bono"),e.qZA()()())}function st(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div")(1,"div",38)(2,"label",39),e._uU(3,"N\xfamero de parcela"),e.qZA(),e.TgZ(4,"div",40),e._UZ(5,"input",41),e.qZA()(),e.TgZ(6,"div",38)(7,"label",42),e._uU(8,"Monto a registrar"),e._UZ(9,"br"),e.TgZ(10,"span",34),e._uU(11,"Pendiente:"),e.qZA(),e._uU(12),e.ALo(13,"number"),e.qZA(),e.TgZ(14,"div",40)(15,"div",43)(16,"span",44),e._uU(17,"R$"),e.qZA(),e._UZ(18,"input",45),e.qZA()()(),e.TgZ(19,"div",38),e.YNc(20,ot,2,1,"div",46),e.qZA(),e.TgZ(21,"div",38)(22,"div",47)(23,"input",48,49),e.NdJ("change",function(){e.CHM(i);const o=e.MAs(24),m=e.oxw(2);return e.KtG(m.uploadFile(o))}),e.qZA()(),e.TgZ(25,"div",50)(26,"div",51)(27,"a",52),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.openCamera("payment"))}),e._UZ(28,"span",53),e.qZA()()()(),e._UZ(29,"br"),e.TgZ(30,"div",7)(31,"div",54)(32,"button",55),e.NdJ("click",function(o){e.CHM(i);const m=e.oxw(2);return e.KtG(m.createPayment(o))}),e._uU(33,"Validar pago"),e.qZA()()(),e._UZ(34,"hr"),e.YNc(35,lt,7,0,"div",56),e.qZA()}if(2&t){const i=e.oxw(2);e.xp6(12),e.hij(" ",e.Dn7(13,5,i.elementForm.getRawValue().pending,"","es")," R$"),e.xp6(8),e.Q6J("ngIf",i.paymentImage),e.xp6(3),e.Q6J("uploader",i.uploader),e.xp6(9),e.Q6J("disabled",!i.haveContracts||i.elementForm.controls.paymentClientAmount.errors),e.xp6(3),e.Q6J("ngIf",!i.isClient&&i.activeBonus)}}function ct(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div")(1,"div",19)(2,"div",8)(3,"div",27)(4,"div",12)(5,"div",7)(6,"div",28)(7,"p",29)(8,"b"),e._uU(9,"Valor del art\xedculo"),e.qZA(),e._UZ(10,"br"),e._uU(11),e.ALo(12,"number"),e.qZA()(),e.TgZ(13,"div",28)(14,"p",29)(15,"b"),e._uU(16,"Valor del contrato"),e.qZA(),e._UZ(17,"br"),e.TgZ(18,"span",30),e._uU(19),e.ALo(20,"number"),e.qZA()()()(),e._UZ(21,"hr"),e.TgZ(22,"div",7)(23,"div",31)(24,"p",29)(25,"button",32),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.openPayments())}),e._uU(26," Ver parcelas "),e.qZA()()(),e.TgZ(27,"div",31)(28,"p",29)(29,"b",33),e._uU(30,"Pagado"),e.qZA(),e._UZ(31,"br"),e._uU(32),e.ALo(33,"number"),e.qZA()(),e.TgZ(34,"div",31)(35,"p",29)(36,"b",34),e._uU(37,"Por validar"),e.qZA(),e._UZ(38,"br"),e._uU(39),e.ALo(40,"number"),e.qZA()(),e.TgZ(41,"div",31)(42,"p",29)(43,"b",35),e._uU(44,"Por pagar"),e.qZA(),e._UZ(45,"br"),e._uU(46),e.ALo(47,"number"),e.qZA()()(),e._UZ(48,"hr"),e.TgZ(49,"div",7)(50,"div",28)(51,"p",29)(52,"b"),e._uU(53,"Monto atrasado o incompleto"),e.qZA(),e._UZ(54,"br"),e._uU(55),e.ALo(56,"number"),e.qZA()(),e.TgZ(57,"div",28)(58,"p",29)(59,"b"),e._uU(60,"Monto de la parcela"),e.qZA(),e._UZ(61,"br"),e.TgZ(62,"span",30),e._uU(63),e.ALo(64,"number"),e.qZA()()()()()()()(),e._UZ(65,"hr"),e.TgZ(66,"full-calendar",36,37),e.NdJ("deepChangeDetection",function(){return!0}),e.qZA(),e._UZ(68,"hr"),e.YNc(69,st,36,9,"div",3),e.qZA()}if(2&t){const i=e.oxw();e.xp6(11),e.hij(" ",e.Dn7(12,10,(null==i.lastContract?null:i.lastContract.loanAmount)||0,"","es")," R$ "),e.xp6(8),e.hij("",e.Dn7(20,14,(null==i.lastContract?null:i.lastContract.totalAmount)||0,"","es")," R$"),e.xp6(13),e.hij(" ",e.Dn7(33,18,i.elementForm.getRawValue().clientStablish,"","es")," R$ "),e.xp6(7),e.hij(" ",e.Dn7(40,22,i.elementForm.getRawValue().pendingForValidate,"","es")," R$ "),e.xp6(7),e.hij(" ",e.Dn7(47,26,i.elementForm.getRawValue().clientOpen,"","es")," R$ "),e.xp6(9),e.hij(" ",e.Dn7(56,30,i.elementForm.getRawValue().pending||0,"","es")," R$ "),e.xp6(8),e.hij("",e.Dn7(64,34,(null==i.lastContract?null:i.lastContract.paymentAmount)||0,"","es")," R$"),e.xp6(3),e.Q6J("options",i.calendarOptions)("events",i.calendarEvents),e.xp6(3),e.Q6J("ngIf",i.elementForm.getRawValue().clientOpen>0)}}function dt(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.recalculate())}),e._uU(1,"Recalcular"),e.qZA()}}function mt(t,r){if(1&t){const i=e.EpF();e.TgZ(0,"div",60)(1,"div",61),e.YNc(2,dt,2,0,"button",62),e._UZ(3,"div"),e.TgZ(4,"button",63),e.NdJ("click",function(){e.CHM(i);const o=e.oxw();return e.KtG(o.goBack())}),e._uU(5,"Cerrar"),e.qZA()()()}if(2&t){const i=e.oxw();e.xp6(2),e.Q6J("ngIf","Rt"===(null==i.user?null:i.user.permission))}}N.extend(Je),N.extend(Ee),N.extend(Pe),N.tz.setDefault("America/Manaus");class pt{constructor(r,i){this.src=r,this.file=i}}const ut=[{path:"",redirectTo:"actives",pathMatch:"full"},{path:"actives",component:Ce},{path:"create",component:qe},{path:"detail",component:(()=>{class t{constructor(i,a,o,m,b,q,T,v,s,_,y){var n=this;this.document=i,this.ngxUiLoaderService=a,this.contractsService=o,this.paymentsService=m,this.imagesService=b,this.formBuilder=q,this.dataService=T,this.matDialog=v,this.titleService=s,this.location=_,this.router=y,this.handleDateClick=d=>{const p=N(d.dateStr,"YYYY-MM-DD").format("DD/MM/YYYY"),u=N(this.lastContract?.createdAt,"DD/MM/YYYY HH:mm:ss").format("DD/MM/YYYY"),h=this.paymentDays.find(A=>N(A).tz().format("DD/MM/YYYY")===p),g=u===p,f=this.contractMovements.filter(A=>A.movementDate===p);let C=!1,x="",Z=0;for(let A=0;A<f.length;A++){const S=f[A],M=N(S.createdAt,"DD/MM/YYYY HH:mm:ss").format("hh:mm A");Z+=Number.parseInt(S.amount),"pending"===S.status&&(C=!0),x+='<div style="background-color: #DBDBDB; padding: 1em 0; border-radius: 20px;">',x+=`<p><b>Estatus:</b> ${"pending"===S.status?'<span style="color: orange">Pendiente de validaci\xf3n</span>':'<span style="color: green">Validado</span>'}</p>`,x+=`<p><b>Pago #${A+1} - Monto:</b> ${S.amount} R$<br><code>${M}</code></p>`,x+="</div>",x+=S.paymentPicture&&""!==S.paymentPicture?`<br><img src="${S.paymentPicture}" class="card-img-top" alt="..."><hr>`:"<hr>"}const F=f.length?C?"warning":"success":"error";(g||h||f.length)&&Y().fire({title:`<strong>${p}</strong>`,icon:F,html:f.length?`<p><b>Pago realizado</b></p><br><p><b>Total pagado:</b> ${Z} R$</p><br><hr>`+x:"<p>No hay pagos registrados</p>",showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})},this.latitude=0,this.longitude=0,this.calendarOptions={locales:Fe.Z,locale:"es-es",plugins:[ke.Z,Ne.Z,Ye.Z,we.ZP],headerToolbar:{left:"prev,today,next",center:"title",right:""},initialView:"dayGridMonth",weekends:!0,editable:!1,selectable:!0,selectMirror:!1,dayMaxEvents:!0,themeSystem:"standard",dateClick:this.handleDateClick.bind(this)},this.calendarEvents=[],this.isClient=!1,this.activeBonus=!1,this.haveContracts=!1,this.haveActiveContracts=!1,this.profilePicture="assets/images/others/placeholder.jpg",this.addressPicture="assets/images/others/placeholder.jpg",this.lastContract=null,this.existClient=null,this.loggedUser=null,this.paymentIncompleteDays=[],this.paymentAheadDays=[],this.paymentDays=[],this.contractMovements=[],this.paymentImage=null,this.uploader=new z.bA({allowedMimeType:["image/png","image/jpg","image/jpeg"],maxFileSize:1048576,autoUpload:!1,isHTML5:!0,url:""}),this.setGeolocation=()=>{navigator.geolocation.getCurrentPosition(d=>{var p=d.coords;console.log("Your current position is:"),console.log("Latitude : "+p.latitude),console.log("Longitude: "+p.longitude),console.log("More or less "+p.accuracy+" meters."),this.latitude=p.latitude,this.longitude=p.longitude},d=>{console.warn("Ha ocurrido un error ("+d.code+"): "+d.message)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})},this.redirect=(d="")=>{this.router.navigate(""!==d?[`${d}`]:[D.f.routes.dash])},this.createForm=()=>this.formBuilder.group({cpf:["",l.kI.required],name:["",l.kI.required],residence:["",l.kI.required],billing:["",l.kI.required],phone:["",l.kI.required],points:[0,l.kI.required],bonds:["",l.kI.required],refers:["",l.kI.required],countContracts:["",l.kI.required],lastContractDate:["",l.kI.required],clientOpen:[0,l.kI.required],clientStablish:[0,l.kI.required],pending:[0,l.kI.required],daysLate:[0,l.kI.required],daysExpired:[0,l.kI.required],daysIncomplete:[0,l.kI.required],daysAhead:[0,l.kI.required],paymentClientNumber:["",l.kI.required],paymentClientAmount:["",l.kI.required],paymentAmount:["",l.kI.required],pendingForValidate:["",l.kI.required],createdBy:["",l.kI.required]}),this.patchFormMainData=()=>{this.elementForm.patchValue({cpf:this.existClient?this.existClient.cpf:"",name:this.existClient?`${this.existClient.firstName} ${this.existClient.paternalSurname}`:"",residence:this.existClient?this.existClient.residenceAddress:"",billing:this.existClient?this.existClient.billingAddress:"",phone:this.existClient?this.existClient.phoneNumber:"",countContracts:0,lastContractDate:"N\xe3o tem contratos"}),this.haveContracts||this.elementForm.controls.paymentClientNumber.disable()},this.patchFormContractsData=d=>{const{pending:p,countContracts:u,lastContractDate:h,clientOpen:g,clientStablish:f,daysLate:C,daysExpired:x,paymentClientNumber:Z,paymentClientAmount:F,paymentAmount:A,pendingForValidate:S,createdBy:M,clientPoints:ft}=d;this.elementForm.patchValue({pending:p,countContracts:u,lastContractDate:h,clientOpen:g,clientStablish:f,daysLate:C,daysExpired:x,paymentClientNumber:Z,paymentClientAmount:F,paymentAmount:A,pendingForValidate:S,points:ft,createdBy:M,daysIncomplete:this.paymentIncompleteDays?.length||0,daysAhead:this.paymentAheadDays?.length||0}),this.elementForm.controls.paymentClientAmount.addValidators(l.kI.max(g))},this.loadData=(0,U.Z)(function*(){n.ngxUiLoaderService.startLoader("loader-02");try{n.loggedUser=n.dataService.getLoggedUser(),n.isClient="Clt"===n.loggedUser?.permission,n.existClient=n.isClient?n.loggedUser:n.dataService.getExistClient(),n.existClient&&(n.profilePicture=""!=n.existClient.profilePicture?n.existClient.profilePicture:n.profilePicture,n.addressPicture=""!=n.existClient.addressPicture?n.existClient.addressPicture:n.addressPicture),n.patchFormMainData();const d=yield n.contractsService.loadContractData(n.existClient?.id);if(d?.data?.patchValue?.countContracts>0){const{haveActiveContracts:p,lastContract:u,paymentIncompleteDays:h,paymentAheadDays:g,calendarEvents:f,paymentDays:C,patchValue:x}=d.data;n.haveActiveContracts=p,n.haveActiveContracts&&(n.lastContract=u,n.lastContract&&(n.lastContract.createdBy=new Le.T(u?.createdBy),n.contractMovements=u?.movementList,x.paymentClientAmount=n.lastContract.paymentAmount),n.paymentIncompleteDays=h,n.paymentAheadDays=g,n.paymentDays=C,n.document.body.classList.contains("dark")&&f.forEach(Z=>{"#FFFFFF"===Z.backgroundColor&&(Z.backgroundColor="#000000")}),n.calendarEvents=f),n.haveContracts=x?.countContracts>0||!1,n.patchFormContractsData(x)}}catch(d){n.dataService.errorHandling(d)}finally{n.ngxUiLoaderService.stopLoader("loader-02")}}),this.recalculate=(0,U.Z)(function*(){n.ngxUiLoaderService.startLoader("loader-02");try{n.loggedUser=n.dataService.getLoggedUser(),n.isClient="Clt"===n.loggedUser?.permission,n.existClient=n.isClient?n.loggedUser:n.dataService.getExistClient(),yield n.contractsService.recalculateContractData(n.existClient?.id),window.location.reload()}catch(d){n.dataService.errorHandling(d)}finally{n.ngxUiLoaderService.stopLoader("loader-02")}}),this.createPayment=function(){var d=(0,U.Z)(function*(p){n.ngxUiLoaderService.startLoader("loader-02");try{if(p.preventDefault(),n.lastContract){const u=n.elementForm.getRawValue(),{clientOpen:h,paymentClientAmount:g}=u;if(g>h)return void n.dataService.errorHandling({front:!0,message:"El pago es mayor que el saldo restante, verifique e intente nuevamente."});let f=null;if(!n.paymentImage)return void n.dataService.errorHandling({front:!0,message:"La imagen del pago es obligatoria, verifique e intente nuevamente."});f=yield n.imagesService.createImage({base64:n.paymentImage,type:"payment"}),yield n.paymentsService.createMovement({type:"new",amount:g,description:"new movement",paymentPicture:f?.id||""},{latitude:n.latitude,longitude:n.longitude},{contract:n.lastContract.id,client:n.existClient?.id||""}),n.isClient?window.location.reload():n.redirect(D.f.routes.contractsPending)}}catch(u){n.dataService.errorHandling(u)}finally{n.ngxUiLoaderService.stopLoader("loader-02")}});return function(p){return d.apply(this,arguments)}}(),this.openImage=d=>{let p="",u="";switch(d){case"client":p="del cliente",u=this.profilePicture;break;case"address":p="de la direcci\xf3n",u=this.addressPicture;break;case"payment":p="del pago",u=this.paymentImage}Y().fire({title:`<strong>Foto ${p}</strong>`,html:`<div class="card"><div class="card-body"><img src="${u}" class="card-img-top" alt="..."></div></div>`,showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})},this.openPayments=()=>{if(this.lastContract){const d=Number.parseInt(this.lastContract.paymentAmount)||0;let p='<li class="list-group-item">\n        <div class="row">\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Fecha</b>\n            </p>\n          </div>\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Abonado</b>\n            </p>\n          </div>\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Restante</b>\n            </p>\n          </div>\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Estado</b>\n            </p>\n          </div>\n        </div>\n      </li>';const u=[];this.lastContract?.paymentList.forEach(h=>{const g=JSON.parse(JSON.stringify(h)),f=u.findIndex(C=>C.paymentDate===g.paymentDate);if(-1===f)u.push(g);else{const C=u[f];C.amount=C.amount+g.amount,C.status=C.status?g.status:!C.status,u[f]=C}}),u.forEach(h=>{const g=d-h.amount;p+=`<li class="list-group-item">\n          <div class="row">\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${h.paymentDate}\n              </p>\n            </div>\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${h.amount} R$\n              </p>\n            </div>\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${g<0?0:g} R$\n              </p>\n            </div>\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${h.status?"Validado":"Pendiente"}\n              </p>\n            </div>\n          </div>\n        </li>`}),Y().fire({title:"<strong>Parcelas con abonos</strong>",html:'<div class="card"><div class="card-body"><ul class="list-group list-group-flush">'+p+"</ul></div></div>",showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})}},this.createContract=()=>{this.existClient&&(this.dataService.setCreatedUser(this.existClient),this.redirect(D.f.routes.contractsCreate))},this.goBack=()=>{this.location.back()},this.openCamera=d=>{this.cameraDialogRef=this.matDialog.open(V.M,{autoFocus:!0,disableClose:!0,height:"90vh",minWidth:"95vw"}),this.cameraDialogRef.afterClosed().subscribe(function(){var p=(0,U.Z)(function*(u){u&&"payment"===d&&(n.paymentImage=u),n.cameraDialogRef=null});return function(u){return p.apply(this,arguments)}}())},this.uploadFile=d=>{const p=d.files[0],u=new FileReader;u.addEventListener("load",function(){var h=(0,U.Z)(function*(g){n.selectedFile=new pt(g.target.result,p),n.paymentImage=g.target.result});return function(g){return h.apply(this,arguments)}}()),u.readAsDataURL(p)},this.user=this.dataService.getLoggedUser(),(!this.dataService.getIsLoggedIn()||!this.user)&&(this.dataService.clearLoginData(),this.redirect(D.f.routes.login)),this.setGeolocation()}ngOnInit(){(0,w.qS)(Se.Z),this.titleService.setTitle("SISTEMA IMPERIAL | Detalles del contrato"),this.elementForm=this.createForm(),this.loadData()}}return t.\u0275fac=function(i){return new(i||t)(e.Y36(w.K0),e.Y36(E.LA),e.Y36(Me.W),e.Y36(He),e.Y36(G.C),e.Y36(l.qu),e.Y36(J.D),e.Y36(O.uw),e.Y36(P.Dx),e.Y36(w.Ye),e.Y36(k.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-clients-detail"]],decls:21,vars:11,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],[4,"ngIf"],["routerLink","/admin/dashboard",4,"ngIf"],["routerLink","/admin/clients/actives",4,"ngIf"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"col-md-12","stretch-card"],[1,"card"],["name","elementForm","novalidate","",3,"formGroup"],["class","card-header","style","text-align: center;",3,"ngStyle",4,"ngIf"],[1,"card-body"],["class","card-footer",4,"ngIf"],[1,"feather","icon-home"],["routerLink","/admin/dashboard"],["routerLink","/admin/clients/actives"],[1,"card-header",2,"text-align","center",3,"ngStyle"],[1,"card-title","mt-0"],[1,"mb-3"],[1,"col-6",2,"text-align","center"],["alt","...",1,"card-img-top",3,"src","click"],["href","javascript:void(0)","target","_blank",3,"click"],[1,"feather","icon-eye"],["class","d-grid gap-2","style","text-align: right",4,"ngIf"],[1,"d-grid","gap-2",2,"text-align","right"],[1,"btn","btn-primary",3,"click"],[1,"card","card-table"],[1,"col-6",2,"padding","0 !important"],[2,"text-align","center"],[2,"font-size","1.2em"],[1,"col-3",2,"padding","0 !important"],["type","button",1,"btn","btn-primary",3,"click"],[2,"color","green"],[2,"color","orange"],[2,"color","rgb(255, 76, 76)"],["id","calendar",3,"options","events","deepChangeDetection"],["calendar",""],[1,"row","mb-3"],["for","paymentClientNumber",1,"col-5","form-label"],[1,"col-7"],["type","number","id","paymentClientNumber","formControlName","paymentClientNumber","autocomplete","off","required","",1,"form-control",2,"text-align","right"],["for","paymentClientAmount",1,"col-5","form-label"],[1,"input-group"],["placement","bottom","ngbTooltip","Tooltip on bottom",1,"input-group-text","hover"],["type","number","id","paymentClientAmount","formControlName","paymentClientAmount","autocomplete","off","required","",1,"form-control",2,"text-align","right"],["class","col-12","style","text-align: center",4,"ngIf"],[1,"col-8"],["id","formFile","type","file","accept","image/png,image/jpeg","ng2FileSelect","",1,"form-control",3,"uploader","change"],["fileInput",""],[1,"col-4"],[1,"d-grid","gap-2"],["href","","href","javascript:void(0)",1,"btn","btn-primary",3,"click"],[1,"feather","icon-camera"],[1,"col-12","d-grid","gap-2",2,"text-align","center"],[1,"btn","btn-primary",3,"disabled","click"],["class","row",4,"ngIf"],[1,"col-12",2,"text-align","center"],[1,"col-6","d-grid","gap-2",2,"text-align","left"],[1,"col-6","d-grid","gap-2",2,"text-align","right"],[1,"card-footer"],["fxLayout","row","fxLayoutAlign","space-between"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"btn","btn-secondary",3,"click"]],template:function(i,a){1&i&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2),e.YNc(3,$e,2,0,"a",3),e.YNc(4,je,2,0,"a",4),e.qZA(),e.TgZ(5,"li",2),e.YNc(6,Ve,2,0,"a",3),e.YNc(7,Ge,2,0,"a",5),e.qZA(),e.TgZ(8,"li",6),e._uU(9,"Detalles del cliente"),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"form",10),e.YNc(14,ze,3,3,"div",11),e.TgZ(15,"div",12),e.YNc(16,tt,43,12,"div",3),e.YNc(17,nt,4,1,"div",3),e.YNc(18,rt,4,1,"div",3),e.YNc(19,ct,70,38,"div",3),e.qZA()(),e.YNc(20,mt,6,1,"div",13),e.qZA()()()),2&i&&(e.xp6(3),e.Q6J("ngIf",a.isClient),e.xp6(1),e.Q6J("ngIf",!a.isClient),e.xp6(2),e.Q6J("ngIf",a.isClient),e.xp6(1),e.Q6J("ngIf",!a.isClient),e.xp6(6),e.Q6J("formGroup",a.elementForm),e.xp6(1),e.Q6J("ngIf",a.isClient),e.xp6(2),e.Q6J("ngIf",!a.isClient),e.xp6(1),e.Q6J("ngIf",!a.haveContracts),e.xp6(1),e.Q6J("ngIf",a.haveContracts&&!a.haveActiveContracts),e.xp6(1),e.Q6J("ngIf",a.haveContracts&&a.haveActiveContracts),e.xp6(1),e.Q6J("ngIf",!a.isClient))},dependencies:[k.rH,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,w.O5,w.PC,L.xw,L.Wh,Qe.Zl,z.C6,j._L,Be.w,l.sg,l.u,w.JJ]}),t})()}];let gt=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[k.Bz.forChild(ut),l.u5,H.A,l.UX,K]}),t})()}}]);