"use strict";(self.webpackChunkimperial=self.webpackChunkimperial||[]).push([[853],{2853:(Zt,j,c)=>{c.r(j),c.d(j,{ClientsModule:()=>Ct});var L=c(9562),o=c(5030),V=c(6356),e=c(2223);let ie=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[o.u5,V.A,o.UX]}),t})();var w=c(5861),G=c(512),F=c(3627),O=c(2611),q=c(2534),ae=c(9025),re=c(5226),J=c.n(re),H=c(6081),z=c(5497),R=c(7066),K=c(9089),Q=c(6550),k=c(4755),P=c(1576);let oe=(()=>{class t{constructor(n){this.sanitizer=n}transform(n,a){return this.sanitizer.bypassSecurityTrustResourceUrl(n)}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(Q.H7,16))},t.\u0275pipe=e.Yjl({name:"safe",type:t,pure:!0}),t})();const le=["searchInput"];function se(t,r){1&t&&(e.TgZ(0,"mat-header-cell",39)(1,"span",40),e._uU(2,"Detalles"),e.qZA()())}function ce(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"mat-cell",39)(1,"span",40)(2,"button",41),e.NdJ("click",function(){const u=e.CHM(n).$implicit,U=e.oxw();return e.KtG(U.openDetails(u))}),e._UZ(3,"span",42),e.qZA()()()}}function de(t,r){1&t&&(e.TgZ(0,"mat-header-cell",43)(1,"span",40),e._uU(2,"Nombre completo"),e.qZA()())}function me(t,r){if(1&t&&(e.TgZ(0,"mat-cell",43)(1,"span",44),e._uU(2),e.qZA()()),2&t){const n=r.$implicit;e.xp6(2),e.Oqu(n.fullname)}}function pe(t,r){1&t&&(e.TgZ(0,"mat-header-cell",45)(1,"span",40),e._uU(2,"Sistema"),e.qZA()())}function ue(t,r){1&t&&e._UZ(0,"span",48)}function ge(t,r){1&t&&e._UZ(0,"span",49)}function fe(t,r){if(1&t&&(e.TgZ(0,"mat-cell",45)(1,"span",40),e.YNc(2,ue,1,0,"span",46),e.YNc(3,ge,1,0,"span",47),e.qZA()()),2&t){const n=r.$implicit;e.xp6(2),e.Q6J("ngIf",n.isLogged),e.xp6(1),e.Q6J("ngIf",!n.isLogged)}}function he(t,r){1&t&&(e.TgZ(0,"mat-header-cell",45)(1,"span",40),e._uU(2,"Puntos"),e.qZA()())}function ve(t,r){if(1&t&&(e.TgZ(0,"mat-cell",45)(1,"span",40)(2,"span",44),e._uU(3),e.qZA()()()),2&t){const n=r.$implicit;e.xp6(3),e.Oqu(n.points)}}function _e(t,r){1&t&&(e.TgZ(0,"mat-header-cell",43)(1,"span",40),e._uU(2,"Tel\xe9fono"),e.qZA()())}function Ce(t,r){if(1&t&&(e.TgZ(0,"mat-cell",43)(1,"span",44),e._uU(2),e.qZA()()),2&t){const n=r.$implicit;e.xp6(2),e.Oqu(n.phoneNumber)}}function xe(t,r){1&t&&(e.TgZ(0,"mat-header-cell",50)(1,"span",40),e._uU(2,"Ubicaci\xf3n"),e.qZA()())}function Ze(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"mat-cell",50)(1,"span",40)(2,"button",51),e.NdJ("click",function(){const u=e.CHM(n).$implicit,U=e.oxw(),E=e.MAs(49);return e.KtG(U.openModal(E,u.geolocation))}),e._UZ(3,"span",52),e.qZA()()()}}function ye(t,r){1&t&&e._UZ(0,"mat-header-row",53)}function be(t,r){1&t&&e._UZ(0,"mat-row",54)}function Ae(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div",55)(1,"h5",56),e._uU(2,"Ubicaci\xf3n"),e.qZA(),e.TgZ(3,"button",57),e.NdJ("click",function(){const u=e.CHM(n).$implicit;return e.KtG(u.close())}),e.qZA()(),e.TgZ(4,"div",58),e._UZ(5,"iframe",59),e.ALo(6,"safe"),e.qZA(),e.TgZ(7,"div",60)(8,"button",61),e.NdJ("click",function(){const u=e.CHM(n).$implicit;return e.KtG(u.close())}),e._uU(9,"Cerrar"),e.qZA()()}if(2&t){const n=e.oxw();e.xp6(5),e.Q6J("src",e.lcZ(6,1,n.mapsURL),e.uOi)}}let Te=(()=>{class t{constructor(n,a,s,u,U,E){var D=this;this.ngxUiLoaderService=n,this.clientsService=a,this.dataService=s,this.modalService=u,this.titleService=U,this.router=E,this.mapsURL="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d127493.98656362396!2d-60.04967500122291!3d-3.044487471110905!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x926c1bc8b37647b7%3A0x2b485c9ff765a9cc!2sManaos%2C%20Amazonas%2C%20Brasil!5e0!3m2!1ses-419!2scl!4v1689376182238!5m2!1ses-419!2scl",this.pagination={},this.totalElements=0,this.pageSizeOptions=ae.X.pageSizeOptions,this.displayedColumns=["details","fullname","points","system","phoneNumber","location"],this.redirect=(x="")=>{this.router.navigate(""!==x?[`${x}`]:[q.f.routes.dash])},this.initPagination=()=>{this.pagination.offset=0,this.pagination.limit=this.defPagination,this.pagination.filter=""},this.dataLoad=(0,w.Z)(function*(){D.ngxUiLoaderService.startLoader("loader-02");try{const x=yield D.clientsService.findActives(D.pagination);x.data&&(D.dataSource=new F.by(x.data),D.totalElements=x.count,D.dataSource.sort=D.sort)}catch(x){D.dataService.errorHandling(x)}finally{D.ngxUiLoaderService.stopLoader("loader-02")}}),this.nextPage=x=>{const{pageSize:l,pageIndex:Z}=x;this.dataService.setSelectedPagination(l),this.defPagination=this.dataService.getSelectedPagination(),this.pagination.offset=this.defPagination*Z,this.pagination.limit=l,this.dataLoad()},this.searchElement=(x=!1)=>{try{this.pagination.filter=this.searchInput.nativeElement.value,x&&(this.paginator&&this.paginator.firstPage(),this.pagination.offset=0,this.dataLoad())}catch(l){this.dataService.errorHandling(l)}},this.openDetails=x=>{this.dataService.setExistClient(x),this.redirect(q.f.routes.clientsDetail)},this.user=this.dataService.getLoggedUser(),(!this.dataService.getIsLoggedIn()||!this.user)&&(this.dataService.clearLoginData(),this.redirect(q.f.routes.login))}ngOnInit(){this.titleService.setTitle("SISTEMA IMPERIAL | Clientes activos"),this.defPagination=this.dataService.getSelectedPagination(),this.initPagination(),this.dataLoad()}openModal(n,a){const s=a.longitude,u=a.latitude;0!==s&&0!==u?(this.mapsURL=`https://www.google.com/maps/embed/v1/place?key=AIzaSyA2JmkNSOr1eP7UgOkB8faxG8jC7q4EnBE&q=${u},${s}`,this.modalService.open(n,{centered:!0}).result.then(()=>{this.mapsURL=""}).catch(U=>{this.mapsURL=""})):J().fire({title:"<strong>Sin datos de ubicaci\xf3n</strong>",html:'<div class="card"><div class="card-body"><p>\n            El cliente no posee datos de ubicaci\xf3n.<br>\n            Es necesario que otorgue permisos de ubicaci\xf3n para usar esta funcionalidad.\n          </p></div></div>',showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(H.LA),e.Y36(z.a),e.Y36(R.D),e.Y36(K.FF),e.Y36(Q.Dx),e.Y36(L.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-clients-actives"]],viewQuery:function(n,a){if(1&n&&(e.Gf(G.NW,7),e.Gf(O.YE,7),e.Gf(le,5)),2&n){let s;e.iGM(s=e.CRH())&&(a.paginator=s.first),e.iGM(s=e.CRH())&&(a.sort=s.first),e.iGM(s=e.CRH())&&(a.searchInput=s.first)}},decls:50,vars:7,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/admin/dashboard"],[1,"feather","icon-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"d-flex","align-items-center","flex-wrap","text-nowrap"],[1,"input-group","me-2","mb-2"],["name","searchInput","placeholder","Buscar",1,"form-control",2,"border-top-left-radius","1rem !important","border-bottom-left-radius","1rem !important","margin-left","0.5em","margin-right","0.5em"],["searchInput",""],["type","button",1,"btn","btn-primary","btn-icon",3,"click"],[1,"feather","icon-search"],[1,"col-md-12","stretch-card"],[1,"card","card-table"],[1,"card-body"],[2,"overflow-x","auto !important"],[1,"table-responsive"],["matSort","",1,"common-table",3,"dataSource"],["table",""],["matColumnDef","details"],["fxFlex","auto 1 100px",4,"matHeaderCellDef"],["fxFlex","auto 1 100px",4,"matCellDef"],["matColumnDef","fullname"],["fxFlex","auto 1 200px",4,"matHeaderCellDef"],["fxFlex","auto 1 200px",4,"matCellDef"],["matColumnDef","system"],["fxFlex","auto 1",4,"matHeaderCellDef"],["fxFlex","auto 1",4,"matCellDef"],["matColumnDef","points"],["matColumnDef","phoneNumber"],["matColumnDef","location"],["fxFlex","auto 1 150px",4,"matHeaderCellDef"],["fxFlex","auto 1 150px",4,"matCellDef"],["class","grey-400-bg font-weight-600",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","user","matRipple","",4,"matRowDef","matRowDefColumns"],[3,"length","pageSizeOptions","pageSize","page"],["paginator",""],["verticalCenteredModal",""],["fxFlex","auto 1 100px"],[2,"margin","0","text-align","center","width","100%"],["type","button","aria-label","remove",1,"btn","btn-primary","btn-icon",3,"click"],[1,"feather","icon-eye","active-icon"],["fxFlex","auto 1 200px"],[2,"margin","0","text-align","left","padding-left","10px","width","100%"],["fxFlex","auto 1"],["class","feather icon-log-in active-icon","style","color: green; background-color: white; padding: 5px;",4,"ngIf"],["class","feather icon-x active-icon","style","color: red; background-color: white; padding: 5px;",4,"ngIf"],[1,"feather","icon-log-in","active-icon",2,"color","green","background-color","white","padding","5px"],[1,"feather","icon-x","active-icon",2,"color","red","background-color","white","padding","5px"],["fxFlex","auto 1 150px"],["type","button","aria-label","remove",1,"btn","btn-danger","btn-icon",3,"click"],[1,"feather","icon-map-pin","active-icon"],[1,"grey-400-bg","font-weight-600"],["matRipple","",1,"user"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["width","100%","height","315","frameborder","0","allowfullscreen","","webkitallowfullscreen","","mozallowfullscreen","","loading","lazy","allowfullscreen","","referrerpolicy","no-referrer-when-downgrade",2,"border","0",3,"src"],[1,"modal-footer"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,a){1&n&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2)(3,"a",3),e._UZ(4,"span",4),e.qZA()(),e.TgZ(5,"li",2),e._uU(6,"Contratos"),e.qZA(),e.TgZ(7,"li",2),e._uU(8,"Clientes"),e.qZA(),e.TgZ(9,"li",5),e._uU(10,"Activos"),e.qZA()()(),e.TgZ(11,"div",6)(12,"div",7)(13,"div",8),e._UZ(14,"input",9,10),e.TgZ(16,"button",11),e.NdJ("click",function(){return a.searchElement(!0)}),e._UZ(17,"span",12),e.qZA()()()(),e.TgZ(18,"div",6)(19,"div",13)(20,"div",14)(21,"div",15)(22,"div",16)(23,"div",17)(24,"mat-table",18,19),e.ynx(26,20),e.YNc(27,se,3,0,"mat-header-cell",21),e.YNc(28,ce,4,0,"mat-cell",22),e.BQk(),e.ynx(29,23),e.YNc(30,de,3,0,"mat-header-cell",24),e.YNc(31,me,3,1,"mat-cell",25),e.BQk(),e.ynx(32,26),e.YNc(33,pe,3,0,"mat-header-cell",27),e.YNc(34,fe,4,2,"mat-cell",28),e.BQk(),e.ynx(35,29),e.YNc(36,he,3,0,"mat-header-cell",27),e.YNc(37,ve,4,1,"mat-cell",28),e.BQk(),e.ynx(38,30),e.YNc(39,_e,3,0,"mat-header-cell",24),e.YNc(40,Ce,3,1,"mat-cell",25),e.BQk(),e.ynx(41,31),e.YNc(42,xe,3,0,"mat-header-cell",32),e.YNc(43,Ze,4,0,"mat-cell",33),e.BQk(),e.YNc(44,ye,1,0,"mat-header-row",34),e.YNc(45,be,1,0,"mat-row",35),e.qZA()()(),e.TgZ(46,"mat-paginator",36,37),e.NdJ("page",function(u){return a.nextPage(u)}),e.qZA()()()()(),e.YNc(48,Ae,10,3,"ng-template",null,38,e.W1O)),2&n&&(e.xp6(24),e.Q6J("dataSource",a.dataSource),e.xp6(20),e.Q6J("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky","true"),e.xp6(1),e.Q6J("matRowDefColumns",a.displayedColumns),e.xp6(1),e.Q6J("length",a.totalElements)("pageSizeOptions",a.pageSizeOptions)("pageSize",a.defPagination))},dependencies:[L.rH,k.O5,O.YE,G.NW,F.BZ,F.fO,F.as,F.w1,F.Dz,F.nj,F.ge,F.ev,F.XQ,F.Gk,P.yH,oe]}),t})();var W=c(6811),Ue=c(5170),X=c(4074),ee=c(5580);function De(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"div",14)(2,"label",35),e._uU(3,"CPF"),e.qZA(),e.TgZ(4,"input",36),e.NdJ("focusout",function(s){e.CHM(n);const u=e.oxw();return e.KtG(u.findClient(s))}),e.qZA()()()}}function Ie(t,r){if(1&t&&(e.TgZ(0,"div")(1,"div",14)(2,"span")(3,"b"),e._uU(4,"CPF:"),e.qZA(),e._uU(5),e.qZA(),e._UZ(6,"br"),e.qZA()()),2&t){const n=e.oxw();e.xp6(5),e.hij(" ",n.elementForm.getRawValue().cpf,"")}}function qe(t,r){1&t&&(e.TgZ(0,"p",46),e._UZ(1,"span",47),e.qZA())}function Se(t,r){if(1&t&&e._UZ(0,"img",48),2&t){const n=e.oxw(2);e.Q6J("src",n.clientImage,e.LSH)}}function we(t,r){1&t&&(e.TgZ(0,"p",46),e._UZ(1,"span",4),e.qZA())}function Fe(t,r){if(1&t&&e._UZ(0,"img",49),2&t){const n=e.oxw(2);e.Q6J("src",n.placeImage,e.LSH)}}function Ne(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div"),e._UZ(1,"hr"),e.TgZ(2,"div",37)(3,"div",38)(4,"div",9)(5,"div",10)(6,"h6",11),e._uU(7,"Cliente"),e.qZA(),e.YNc(8,qe,2,0,"p",39),e.YNc(9,Se,1,1,"img",40),e.qZA(),e.TgZ(10,"div",41)(11,"div",42)(12,"a",43),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.openCamera("client"))}),e._UZ(13,"span",44),e.qZA()()()()(),e.TgZ(14,"div",38)(15,"div",9)(16,"div",10)(17,"h6",11),e._uU(18,"Direcci\xf3n"),e.qZA(),e.YNc(19,we,2,0,"p",39),e.YNc(20,Fe,1,1,"img",45),e.qZA(),e.TgZ(21,"div",41)(22,"div",42)(23,"a",43),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.openCamera("place"))}),e._UZ(24,"span",44),e.qZA()()()()()()()}if(2&t){const n=e.oxw();e.xp6(8),e.Q6J("ngIf",!n.clientImage),e.xp6(1),e.Q6J("ngIf",n.clientImage),e.xp6(10),e.Q6J("ngIf",!n.placeImage),e.xp6(1),e.Q6J("ngIf",n.placeImage)}}function ke(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"button",50),e.NdJ("click",function(s){e.CHM(n);const u=e.oxw();return e.KtG(u.resetPassword(s))}),e._uU(1,"Reiniciar contrase\xf1a"),e.qZA()}}let Ye=(()=>{class t{constructor(n,a,s,u,U,E,D,x){var l=this;this.ngxUiLoaderService=n,this.clientsService=a,this.imagesService=s,this.dataService=u,this.formBuilder=U,this.matDialog=E,this.location=D,this.router=x,this.userToEdit=null,this.type="create",this.clientImage=null,this.placeImage=null,this.createForm=()=>this.formBuilder.group({cpf:["",o.kI.required],name:["",o.kI.required],lastname:["",o.kI.required],gender:["",o.kI.required],residence:["",o.kI.required],work:["",o.kI.required],phone:["",o.kI.required],email:["",o.kI.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$")]}),this.patchForm=()=>{this.elementForm.patchValue({cpf:this.userToEdit?this.userToEdit.cpf:"",name:this.userToEdit?this.userToEdit.firstName:"",lastname:this.userToEdit?this.userToEdit.paternalSurname:"",gender:this.userToEdit?this.userToEdit.gender:"",residence:this.userToEdit?this.userToEdit.residenceAddress:"",work:this.userToEdit?this.userToEdit.billingAddress:"",phone:this.userToEdit?this.userToEdit.phoneNumber:"",email:this.userToEdit?this.userToEdit.email:"cliente@imperial.pronto"}),this.userToEdit&&this.elementForm.controls.cpf.disable()},this.redirect=(Z="")=>{this.router.navigate(""!==Z?[`${Z}`]:[q.f.routes.dash])},this.createClient=function(){var Z=(0,w.Z)(function*(T){l.ngxUiLoaderService.startLoader("loader-02"),T.preventDefault();const i=l.elementForm.getRawValue(),{cpf:d,name:p,lastname:m,gender:_,residence:g,work:C,phone:f,email:v}=i;try{if(""!==d){const h=yield l.clientsService.clientExist(d),{exist:I}=h;if(I)return void l.clientExist(h)}if(v.length&&!Ue.G.isValidEmail(v))return l.dataService.errorHandling({front:!0,message:"La direcci\xf3n de correo no es v\xe1lida, verifique e intente nuevamente."}),void l.ngxUiLoaderService.stopLoader("loader-02");if(l.userToEdit)yield l.clientsService.updateUser(l.userToEdit.id,{email:v,firstName:p.toLowerCase(),paternalSurname:m.toLowerCase(),residenceAddress:g,billingAddress:C,phoneNumber:f,profilePicture:l.clientImage?l.clientImage:"",addressPicture:l.placeImage?l.placeImage:"",gender:_}),l.dataService.clearCreatedUser(),l.location.back();else{let h=null,I=null;if(!l.clientImage)return void l.dataService.errorHandling({front:!0,message:"La imagen del cliente es obligatoria, verifique e intente nuevamente."});if(h=yield l.imagesService.createImage({base64:l.clientImage,type:"client"}),!l.placeImage)return void l.dataService.errorHandling({front:!0,message:"La imagen de la direcci\xf3n es obligatoria, verifique e intente nuevamente."});I=yield l.imagesService.createImage({base64:l.placeImage,type:"direction"});const y=yield l.clientsService.createUser({cpf:d.toLowerCase().trim(),email:v,firstName:p.toLowerCase(),paternalSurname:m.toLowerCase(),residenceAddress:g,billingAddress:C,phoneNumber:f,profilePicture:h?h.id:"",addressPicture:I?I.id:"",gender:_});422===y?.status?(l.dataService.setExistClient(y.data?.user),l.redirect(q.f.routes.clientsDetail)):(l.dataService.setCreatedUser(y),l.redirect(q.f.routes.contractsCreate))}}catch(h){404!==h.status&&l.dataService.errorHandling(h)}finally{l.ngxUiLoaderService.stopLoader("loader-02")}});return function(T){return Z.apply(this,arguments)}}(),this.resetPassword=function(){var Z=(0,w.Z)(function*(T){try{T.preventDefault(),l.userToEdit&&(yield l.clientsService.resetUserPassword(l.userToEdit.id)),l.dataService.clearCreatedUser(),l.redirect(q.f.routes.configWorkers)}catch(i){l.dataService.errorHandling(i)}finally{l.ngxUiLoaderService.stopLoader("loader-02")}});return function(T){return Z.apply(this,arguments)}}(),this.clientExist=Z=>{J().fire({title:"\xa1El cliente ya est\xe1 registrado!",text:"El CPF ingresado ya existe en nuestros registros. \xbfDesea continuar con otro CPF o ir a los datos del cliente?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ir a los datos del cliente",cancelButtonText:"Continuar"}).then(T=>{T.isConfirmed?(this.dataService.setExistClient(Z),this.redirect(q.f.routes.clientsDetail)):this.elementForm.patchValue({cpf:""})})},this.findClient=function(){var Z=(0,w.Z)(function*(T){try{const i=T.target.value;if(""!==i){const d=yield l.clientsService.findClient(i);d&&l.clientExist(d)}}catch(i){404!==i.status&&l.dataService.errorHandling(i)}});return function(T){return Z.apply(this,arguments)}}(),this.openCamera=Z=>{this.cameraDialogRef=this.matDialog.open(W.M,{autoFocus:!0,disableClose:!0,height:"90vh",minWidth:"95vw"}),this.cameraDialogRef.afterClosed().subscribe(function(){var T=(0,w.Z)(function*(i){if(i)switch(Z){case"client":l.clientImage=i;break;case"place":l.placeImage=i}l.cameraDialogRef=null});return function(i){return T.apply(this,arguments)}}())}}ngOnInit(){this.userToEdit=this.dataService.getCreatedUser()??null,this.userToEdit?this.type="edit":this.dataService.clearCreatedUser(),this.elementForm=this.createForm(),this.patchForm()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(H.LA),e.Y36(z.a),e.Y36(X.C),e.Y36(R.D),e.Y36(o.qu),e.Y36(ee.uw),e.Y36(k.Ye),e.Y36(L.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-clients-create"]],decls:59,vars:8,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/admin/dashboard"],[1,"feather","icon-home"],["routerLink","/admin/clients/actives"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"col-md-12","stretch-card"],[1,"card"],[1,"card-body"],[1,"card-title"],["name","elementForm","novalidate","",3,"formGroup"],[4,"ngIf"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name","autocomplete","off","required","",1,"form-control"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","autocomplete","off","required","",1,"form-control"],["for","gender",1,"form-label"],["id","gender","formControlName","gender","required","",1,"form-select"],["value","male","selected",""],["value","female"],["for","residence",1,"form-label"],["type","text","id","residence","formControlName","residence","autocomplete","off","required","",1,"form-control"],["for","work",1,"form-label"],["type","text","id","work","formControlName","work","autocomplete","off","required","",1,"form-control"],["for","phone",1,"form-label"],["type","text","id","phone","appInputRestriction","int","oninput","this.value=this.value.replace(/[^0-9]/g,'')","formControlName","phone","autocomplete","off","required","",1,"form-control"],["for","email",1,"form-label"],["type","text","id","email","formControlName","email","autocomplete","off",1,"form-control"],["fxLayout","row","fxLayoutAlign","space-between"],["class","btn btn-primary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"btn","btn-secondary",3,"routerLink","click"],["for","cpf",1,"form-label"],["type","text","id","cpf","appInputRestriction","int","oninput","this.value=this.value.replace(/[^0-9]/g,'')","formControlName","cpf","autocomplete","off","required","",1,"form-control",3,"focusout"],[1,"row","justify-content-md-center"],[1,"col-6","col-md-3"],["class","card-text mb-3","style","font-size: 3.5em; text-align: center;",4,"ngIf"],["class","profile-image card-img-top","title","clientImage","style","margin: 0 auto;",3,"src",4,"ngIf"],[1,"card-footer"],[1,"d-grid","gap-2"],["href","","href","javascript:void(0)",1,"btn","btn-primary",3,"click"],[1,"feather","icon-camera"],["class","profile-image card-img-top","title","placeImage","style","margin: 0 auto;",3,"src",4,"ngIf"],[1,"card-text","mb-3",2,"font-size","3.5em","text-align","center"],[1,"feather","icon-user"],["title","clientImage",1,"profile-image","card-img-top",2,"margin","0 auto",3,"src"],["title","placeImage",1,"profile-image","card-img-top",2,"margin","0 auto",3,"src"],[1,"btn","btn-primary",3,"click"]],template:function(n,a){1&n&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2)(3,"a",3),e._UZ(4,"span",4),e.qZA()(),e.TgZ(5,"li",2)(6,"a",5),e._uU(7,"Clientes"),e.qZA()(),e.TgZ(8,"li",6),e._uU(9),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"h6",11),e._uU(15,"Registro"),e.qZA(),e.TgZ(16,"form",12),e.YNc(17,De,5,0,"div",13),e.YNc(18,Ie,7,1,"div",13),e.TgZ(19,"div",14)(20,"label",15),e._uU(21,"Nombre"),e.qZA(),e._UZ(22,"input",16),e.qZA(),e.TgZ(23,"div",14)(24,"label",17),e._uU(25,"Apellido"),e.qZA(),e._UZ(26,"input",18),e.qZA(),e.TgZ(27,"div",14)(28,"label",19),e._uU(29,"Sexo"),e.qZA(),e.TgZ(30,"select",20)(31,"option",21),e._uU(32,"Hombre"),e.qZA(),e.TgZ(33,"option",22),e._uU(34,"Mujer"),e.qZA()()(),e.TgZ(35,"div",14)(36,"label",23),e._uU(37,"Direcci\xf3n residencial"),e.qZA(),e._UZ(38,"input",24),e.qZA(),e.TgZ(39,"div",14)(40,"label",25),e._uU(41,"Direcci\xf3n de cobro"),e.qZA(),e._UZ(42,"input",26),e.qZA(),e.TgZ(43,"div",14)(44,"label",27),e._uU(45,"N\xfamero de tel\xe9fono"),e.qZA(),e._UZ(46,"input",28),e.qZA(),e.TgZ(47,"div",14)(48,"label",29),e._uU(49,"E-Mail"),e.qZA(),e._UZ(50,"input",30),e.qZA(),e.YNc(51,Ne,25,4,"div",13),e._UZ(52,"hr"),e.TgZ(53,"div",31),e.YNc(54,ke,2,0,"button",32),e.TgZ(55,"button",33),e.NdJ("click",function(u){return a.createClient(u)}),e._uU(56,"Aceptar"),e.qZA(),e.TgZ(57,"button",34),e.NdJ("click",function(){return!1}),e._uU(58,"Cancelar"),e.qZA()()()()()()()),2&n&&(e.xp6(9),e.hij("","edit"===a.type?"Editar":"Registrar"," cliente"),e.xp6(7),e.Q6J("formGroup",a.elementForm),e.xp6(1),e.Q6J("ngIf","create"===a.type),e.xp6(1),e.Q6J("ngIf","edit"===a.type),e.xp6(33),e.Q6J("ngIf","create"===a.type),e.xp6(3),e.Q6J("ngIf","edit"===a.type),e.xp6(1),e.Q6J("disabled",a.elementForm.invalid),e.xp6(2),e.Q6J("routerLink","/admin/dashboard"))},dependencies:[L.rH,o._Y,o.YN,o.Kr,o.Fj,o.EJ,o.JJ,o.JL,o.Q7,k.O5,P.xw,P.Wh,o.sg,o.u]}),t})();var te=c(7317),Le=c(7228),N=c(1764),Ee=c(821),Je=c(4255),Pe=c(5911),Me=c(7552),Re=c(7778),He=c(2417),Qe=c(274),Be=c(1545),$e=c(5268),je=c(8405),Ve=c(3144);let Ge=(()=>{class t extends R.D{constructor(n){var a;super(),a=this,this.http=n,this.createPayment=function(){var s=(0,w.Z)(function*(u,U){return a.http.post(`${a.getApiUrl()}/payments`,{payments:u,geolocation:U},{headers:a.getHeaders()}).toPromise()});return function(u,U){return s.apply(this,arguments)}}()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(Ve.eN))},t.\u0275dir=e.lG2({type:t,features:[e.qOj]}),t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Oe=c(5829),ze=c(9476);function Ke(t,r){1&t&&(e.TgZ(0,"a"),e._UZ(1,"span",14),e.qZA())}function We(t,r){1&t&&(e.TgZ(0,"a",15),e._UZ(1,"span",14),e.qZA())}function Xe(t,r){1&t&&(e.TgZ(0,"a"),e._uU(1,"Clientes"),e.qZA())}function et(t,r){1&t&&(e.TgZ(0,"a",16),e._uU(1,"Clientes"),e.qZA())}const tt=function(){return{"background-color":"primary"}};function nt(t,r){if(1&t&&(e.TgZ(0,"div",17)(1,"span",18),e._uU(2),e.qZA()()),2&t){const n=e.oxw();e.Q6J("ngStyle",e.DdM(2,tt)),e.xp6(2),e.hij(" ",n.elementForm.getRawValue().name," ")}}function it(t,r){if(1&t&&(e.TgZ(0,"div")(1,"span")(2,"b"),e._uU(3,"Bonos por cliente:"),e.qZA(),e._uU(4),e.qZA(),e._UZ(5,"br"),e.TgZ(6,"span")(7,"b"),e._uU(8,"Clientes referidos:"),e.qZA(),e._uU(9),e.TgZ(10,"a",22),e.NdJ("click",function(){return!1}),e._UZ(11,"span",23),e.qZA()(),e._UZ(12,"br"),e.qZA()),2&t){const n=e.oxw(2);e.xp6(4),e.hij(" ",n.elementForm.getRawValue().bonds,""),e.xp6(5),e.hij(" ",n.elementForm.getRawValue().refers," ")}}function at(t,r){if(1&t&&(e.TgZ(0,"span")(1,"b"),e._uU(2,"Fecha del contrato:"),e.qZA(),e._uU(3),e._UZ(4,"br"),e.qZA()),2&t){const n=e.oxw(2);e.xp6(3),e.hij(" ",n.elementForm.getRawValue().lastContractDate,"")}}function rt(t,r){if(1&t&&(e.TgZ(0,"span")(1,"b"),e._uU(2,"Cliente registrado por:"),e.qZA(),e._uU(3),e._UZ(4,"br"),e.qZA()),2&t){const n=e.oxw(2);e.xp6(3),e.hij(" ",n.elementForm.getRawValue().createdBy||"","")}}function ot(t,r){if(1&t&&(e.TgZ(0,"span")(1,"b"),e._uU(2,"Contrato registrado por:"),e.qZA(),e._uU(3),e._UZ(4,"br"),e.qZA()),2&t){const n=e.oxw(2);e.xp6(3),e.hij(" ",(null==n.lastContract||null==n.lastContract.createdBy?null:n.lastContract.createdBy.getFullName())||"","")}}function lt(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"div",19)(2,"div",7)(3,"div",20)(4,"img",21),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.openImage("client"))}),e.qZA()(),e.TgZ(5,"div",20)(6,"img",21),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.openImage("address"))}),e.qZA()()()(),e._UZ(7,"hr"),e.TgZ(8,"div",19)(9,"span")(10,"b"),e._uU(11,"CPF:"),e.qZA(),e._uU(12),e.qZA(),e._UZ(13,"br"),e.TgZ(14,"span")(15,"b"),e._uU(16,"Nombre:"),e.qZA(),e._uU(17),e.qZA(),e._UZ(18,"br"),e.TgZ(19,"span")(20,"b"),e._uU(21,"Direcci\xf3n residencial:"),e.qZA(),e._uU(22),e.qZA(),e._UZ(23,"br"),e.TgZ(24,"span")(25,"b"),e._uU(26,"N\xfamero de Tel\xe9fono:"),e.qZA(),e._uU(27),e.qZA(),e._UZ(28,"br"),e.YNc(29,it,13,2,"div",3),e.TgZ(30,"span")(31,"b"),e._uU(32,"N\xfamero de contratos:"),e.qZA(),e._uU(33),e.qZA(),e._UZ(34,"br"),e.TgZ(35,"span")(36,"b"),e._uU(37,"Puntos del cliente:"),e.qZA(),e._uU(38),e.qZA(),e._UZ(39,"br"),e.YNc(40,at,5,1,"span",3),e.YNc(41,rt,5,1,"span",3),e.YNc(42,ot,5,1,"span",3),e.qZA()()}if(2&t){const n=e.oxw();e.xp6(4),e.Q6J("src",n.profilePicture,e.LSH),e.xp6(2),e.Q6J("src",n.addressPicture,e.LSH),e.xp6(6),e.hij(" ",n.elementForm.getRawValue().cpf,""),e.xp6(5),e.hij(" ",n.elementForm.getRawValue().name,""),e.xp6(5),e.hij(" ",n.elementForm.getRawValue().residence,""),e.xp6(5),e.hij(" ",n.elementForm.getRawValue().phone,""),e.xp6(2),e.Q6J("ngIf",n.activeBonus),e.xp6(4),e.hij(" ",n.elementForm.getRawValue().countContracts,""),e.xp6(5),e.hij(" ",n.elementForm.getRawValue().points,""),e.xp6(2),e.Q6J("ngIf",n.haveContracts),e.xp6(1),e.Q6J("ngIf",!n.isClient),e.xp6(1),e.Q6J("ngIf",n.haveContracts)}}function st(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div",25),e._UZ(1,"hr"),e.TgZ(2,"button",26),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2);return e.KtG(s.createContract())}),e._uU(3,"Registrar contrato"),e.qZA()()}}function ct(t,r){if(1&t&&(e.TgZ(0,"div")(1,"span"),e._uU(2,"El cliente no posee contratos"),e.qZA(),e.YNc(3,st,4,0,"div",24),e.qZA()),2&t){const n=e.oxw();e.xp6(3),e.Q6J("ngIf",!n.isClient)}}function dt(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div",25),e._UZ(1,"hr"),e.TgZ(2,"button",26),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2);return e.KtG(s.createContract())}),e._uU(3,"Registrar contrato"),e.qZA()()}}function mt(t,r){if(1&t&&(e.TgZ(0,"div")(1,"span"),e._uU(2,"El cliente no posee contratos activos"),e.qZA(),e.YNc(3,dt,4,0,"div",24),e.qZA()),2&t){const n=e.oxw();e.xp6(3),e.Q6J("ngIf",!n.isClient)}}function pt(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div",57)(1,"img",21),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(3);return e.KtG(s.openImage("payment"))}),e.qZA()()}if(2&t){const n=e.oxw(3);e.xp6(1),e.Q6J("src",n.paymentImage,e.LSH)}}function ut(t,r){1&t&&(e.TgZ(0,"div",7)(1,"div",58)(2,"button",26),e.NdJ("click",function(){return!1}),e._uU(3,"Usar puntos"),e.qZA()(),e.TgZ(4,"div",59)(5,"button",26),e.NdJ("click",function(){return!1}),e._uU(6,"Usar bono"),e.qZA()()())}function gt(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"div",38)(2,"label",39),e._uU(3,"N\xfamero de parcela"),e.qZA(),e.TgZ(4,"div",40),e._UZ(5,"input",41),e.qZA()(),e.TgZ(6,"div",38)(7,"label",42),e._uU(8,"Monto a registrar"),e._UZ(9,"br"),e.TgZ(10,"span",34),e._uU(11,"Pendiente:"),e.qZA(),e._uU(12),e.ALo(13,"number"),e.qZA(),e.TgZ(14,"div",40)(15,"div",43)(16,"span",44),e._uU(17,"R$"),e.qZA(),e._UZ(18,"input",45),e.qZA()()(),e.TgZ(19,"div",38),e.YNc(20,pt,2,1,"div",46),e.qZA(),e.TgZ(21,"div",38)(22,"div",47)(23,"input",48,49),e.NdJ("change",function(){e.CHM(n);const s=e.MAs(24),u=e.oxw(2);return e.KtG(u.uploadFile(s))}),e.qZA()(),e.TgZ(25,"div",50)(26,"div",51)(27,"a",52),e.NdJ("click",function(){e.CHM(n);const s=e.oxw(2);return e.KtG(s.openCamera("payment"))}),e._UZ(28,"span",53),e.qZA()()()(),e._UZ(29,"br"),e.TgZ(30,"div",7)(31,"div",54)(32,"button",55),e.NdJ("click",function(s){e.CHM(n);const u=e.oxw(2);return e.KtG(u.createPayment(s))}),e._uU(33,"Validar pago"),e.qZA()()(),e._UZ(34,"hr"),e.YNc(35,ut,7,0,"div",56),e.qZA()}if(2&t){const n=e.oxw(2);e.xp6(12),e.hij(" ",e.Dn7(13,5,n.elementForm.getRawValue().pending,"","es")," R$"),e.xp6(8),e.Q6J("ngIf",n.paymentImage),e.xp6(3),e.Q6J("uploader",n.uploader),e.xp6(9),e.Q6J("disabled",!n.haveContracts||n.elementForm.controls.paymentClientAmount.errors),e.xp6(3),e.Q6J("ngIf",!n.isClient&&n.activeBonus)}}function ft(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div")(1,"div",19)(2,"div",8)(3,"div",27)(4,"div",12)(5,"div",7)(6,"div",28)(7,"p",29)(8,"b"),e._uU(9,"Valor del art\xedculo"),e.qZA(),e._UZ(10,"br"),e._uU(11),e.ALo(12,"number"),e.qZA()(),e.TgZ(13,"div",28)(14,"p",29)(15,"b"),e._uU(16,"Valor del contrato"),e.qZA(),e._UZ(17,"br"),e.TgZ(18,"span",30),e._uU(19),e.ALo(20,"number"),e.qZA()()()(),e._UZ(21,"hr"),e.TgZ(22,"div",7)(23,"div",31)(24,"p",29)(25,"button",32),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.openPayments())}),e._uU(26," Ver parcelas "),e.qZA()()(),e.TgZ(27,"div",31)(28,"p",29)(29,"b",33),e._uU(30,"Pagado"),e.qZA(),e._UZ(31,"br"),e._uU(32),e.ALo(33,"number"),e.qZA()(),e.TgZ(34,"div",31)(35,"p",29)(36,"b",34),e._uU(37,"Por validar"),e.qZA(),e._UZ(38,"br"),e._uU(39),e.ALo(40,"number"),e.qZA()(),e.TgZ(41,"div",31)(42,"p",29)(43,"b",35),e._uU(44,"Por pagar"),e.qZA(),e._UZ(45,"br"),e._uU(46),e.ALo(47,"number"),e.qZA()()(),e._UZ(48,"hr"),e.TgZ(49,"div",7)(50,"div",28)(51,"p",29)(52,"b"),e._uU(53,"Monto atrasado o incompleto"),e.qZA(),e._UZ(54,"br"),e._uU(55),e.ALo(56,"number"),e.qZA()(),e.TgZ(57,"div",28)(58,"p",29)(59,"b"),e._uU(60,"Monto de la parcela"),e.qZA(),e._UZ(61,"br"),e.TgZ(62,"span",30),e._uU(63),e.ALo(64,"number"),e.qZA()()()()()()()(),e._UZ(65,"hr"),e.TgZ(66,"full-calendar",36,37),e.NdJ("deepChangeDetection",function(){return!0}),e.qZA(),e._UZ(68,"hr"),e.YNc(69,gt,36,9,"div",3),e.qZA()}if(2&t){const n=e.oxw();e.xp6(11),e.hij(" ",e.Dn7(12,10,(null==n.lastContract?null:n.lastContract.loanAmount)||0,"","es")," R$ "),e.xp6(8),e.hij("",e.Dn7(20,14,(null==n.lastContract?null:n.lastContract.totalAmount)||0,"","es")," R$"),e.xp6(13),e.hij(" ",e.Dn7(33,18,n.elementForm.getRawValue().clientStablish,"","es")," R$ "),e.xp6(7),e.hij(" ",e.Dn7(40,22,n.elementForm.getRawValue().pendingForValidate,"","es")," R$ "),e.xp6(7),e.hij(" ",e.Dn7(47,26,n.elementForm.getRawValue().clientOpen,"","es")," R$ "),e.xp6(9),e.hij(" ",e.Dn7(56,30,n.elementForm.getRawValue().pending||0,"","es")," R$ "),e.xp6(8),e.hij("",e.Dn7(64,34,(null==n.lastContract?null:n.lastContract.paymentAmount)||0,"","es")," R$"),e.xp6(3),e.Q6J("options",n.calendarOptions)("events",n.calendarEvents),e.xp6(3),e.Q6J("ngIf",n.elementForm.getRawValue().clientOpen>0)}}function ht(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div",60)(1,"div",61),e._UZ(2,"div"),e.TgZ(3,"button",62),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.goBack())}),e._uU(4,"Cerrar"),e.qZA()()()}}N.extend(Qe),N.extend(Be),N.extend($e),N.tz.setDefault("America/Manaus");class vt{constructor(r,n){this.src=r,this.file=n}}const _t=[{path:"",redirectTo:"actives",pathMatch:"full"},{path:"actives",component:Te},{path:"create",component:Ye},{path:"detail",component:(()=>{class t{constructor(n,a,s,u,U,E,D,x,l,Z,T){var i=this;this.document=n,this.ngxUiLoaderService=a,this.contractsService=s,this.paymentsService=u,this.imagesService=U,this.formBuilder=E,this.dataService=D,this.matDialog=x,this.titleService=l,this.location=Z,this.router=T,this.handleDateClick=d=>{const p=N(d.dateStr,"YYYY-MM-DD").format("DD/MM/YYYY"),m=N(this.lastContract?.createdAt,"DD/MM/YYYY HH:mm:ss").format("DD/MM/YYYY"),_=this.paymentDays.find(y=>N(y).tz().format("DD/MM/YYYY")===p),g=m===p,C=this.contractMovements.filter(y=>y.movementDate===p);let f=!1,v="",h=0;for(let y=0;y<C.length;y++){const b=C[y],A=N(b.createdAt,"DD/MM/YYYY HH:mm:ss").format("hh:mm A");h+=Number.parseInt(b.amount),"pending"===b.status&&(f=!0),v+='<div style="background-color: #DBDBDB; padding: 1em 0; border-radius: 20px;">',v+=`<p><b>Estatus:</b> ${"pending"===b.status?'<span style="color: orange">Pendiente de validaci\xf3n</span>':'<span style="color: green">Validado</span>'}</p>`,v+=`<p><b>Pago #${y+1} - Monto:</b> ${b.amount} R$<br><code>${A}</code></p>`,v+="</div>",v+=b.paymentPicture&&""!==b.paymentPicture?`<br><img src="${b.paymentPicture}" class="card-img-top" alt="..."><hr>`:"<hr>"}const I=C.length?f?"warning":"success":"error";(g||_||C.length)&&J().fire({title:`<strong>${p}</strong>`,icon:I,html:C.length?`<p><b>Pago realizado</b></p><br><p><b>Total pagado:</b> ${h} R$</p><br><hr>`+v:"<p>No hay pagos registrados</p>",showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})},this.latitude=0,this.longitude=0,this.calendarOptions={locales:Je.Z,locale:"es-es",plugins:[Me.Z,Pe.Z,Re.Z,Ee.ZP],headerToolbar:{left:"prev,today,next",center:"title",right:""},initialView:"dayGridMonth",weekends:!0,editable:!1,selectable:!0,selectMirror:!1,dayMaxEvents:!0,themeSystem:"standard",dateClick:this.handleDateClick.bind(this)},this.calendarEvents=[],this.isClient=!1,this.activeBonus=!1,this.haveContracts=!1,this.haveActiveContracts=!1,this.profilePicture="assets/images/others/placeholder.jpg",this.addressPicture="assets/images/others/placeholder.jpg",this.lastContract=null,this.existClient=null,this.loggedUser=null,this.paymentIncompleteDays=[],this.paymentAheadDays=[],this.paymentDays=[],this.contractMovements=[],this.paymentImage=null,this.uploader=new te.bA({allowedMimeType:["image/png","image/jpg","image/jpeg"],maxFileSize:1048576,autoUpload:!1,isHTML5:!0,url:""}),this.setGeolocation=()=>{navigator.geolocation.getCurrentPosition(d=>{var p=d.coords;console.log("Your current position is:"),console.log("Latitude : "+p.latitude),console.log("Longitude: "+p.longitude),console.log("More or less "+p.accuracy+" meters."),this.latitude=p.latitude,this.longitude=p.longitude},d=>{console.warn("Ha ocurrido un error ("+d.code+"): "+d.message)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})},this.redirect=(d="")=>{this.router.navigate(""!==d?[`${d}`]:[q.f.routes.dash])},this.createForm=()=>this.formBuilder.group({cpf:["",o.kI.required],name:["",o.kI.required],residence:["",o.kI.required],billing:["",o.kI.required],phone:["",o.kI.required],points:[0,o.kI.required],bonds:["",o.kI.required],refers:["",o.kI.required],countContracts:["",o.kI.required],lastContractDate:["",o.kI.required],clientOpen:[0,o.kI.required],clientStablish:[0,o.kI.required],pending:[0,o.kI.required],daysLate:[0,o.kI.required],daysExpired:[0,o.kI.required],daysIncomplete:[0,o.kI.required],daysAhead:[0,o.kI.required],paymentClientNumber:["",o.kI.required],paymentClientAmount:["",o.kI.required],paymentAmount:["",o.kI.required],pendingForValidate:["",o.kI.required],createdBy:["",o.kI.required]}),this.patchFormMainData=()=>{this.elementForm.patchValue({cpf:this.existClient?this.existClient.cpf:"",name:this.existClient?`${this.existClient.firstName} ${this.existClient.paternalSurname}`:"",residence:this.existClient?this.existClient.residenceAddress:"",billing:this.existClient?this.existClient.billingAddress:"",phone:this.existClient?this.existClient.phoneNumber:"",countContracts:0,lastContractDate:"N\xe3o tem contratos"}),this.haveContracts||this.elementForm.controls.paymentClientNumber.disable()},this.patchFormContractsData=d=>{const{pending:p,countContracts:m,lastContractDate:_,clientOpen:g,clientStablish:C,daysLate:f,daysExpired:v,paymentClientNumber:h,paymentClientAmount:I,paymentAmount:y,pendingForValidate:b,createdBy:A,clientPoints:Y}=d;this.elementForm.patchValue({pending:p,countContracts:m,lastContractDate:_,clientOpen:g,clientStablish:C,daysLate:f,daysExpired:v,paymentClientNumber:h,paymentClientAmount:I,paymentAmount:y,pendingForValidate:b,points:Y,createdBy:A,daysIncomplete:this.paymentIncompleteDays?.length||0,daysAhead:this.paymentAheadDays?.length||0}),this.elementForm.controls.paymentClientAmount.addValidators(o.kI.max(g))},this.loadData=(0,w.Z)(function*(){i.ngxUiLoaderService.startLoader("loader-02");try{i.loggedUser=i.dataService.getLoggedUser(),i.isClient="Clt"===i.loggedUser?.permission,i.existClient=i.isClient?i.loggedUser:i.dataService.getExistClient(),i.existClient&&(i.profilePicture=""!=i.existClient.profilePicture?i.existClient.profilePicture:i.profilePicture,i.addressPicture=""!=i.existClient.addressPicture?i.existClient.addressPicture:i.addressPicture),i.patchFormMainData();const d=yield i.contractsService.loadContractData(i.existClient?.id);if(d?.data?.patchValue?.countContracts>0){const{haveActiveContracts:p,lastContract:m,paymentIncompleteDays:_,paymentAheadDays:g,calendarEvents:C,paymentDays:f,patchValue:v}=d.data;i.haveActiveContracts=p,i.haveActiveContracts&&(i.lastContract=m,i.lastContract&&(i.lastContract.createdBy=new He.T(m?.createdBy),i.contractMovements=m?.movementList,v.paymentClientAmount=i.lastContract.paymentAmount),i.paymentIncompleteDays=_,i.paymentAheadDays=g,i.paymentDays=f,i.document.body.classList.contains("dark")&&C.forEach(h=>{"#FFFFFF"===h.backgroundColor&&(h.backgroundColor="#000000")}),i.calendarEvents=C),i.haveContracts=v?.countContracts>0||!1,i.patchFormContractsData(v)}}catch(d){i.dataService.errorHandling(d)}finally{i.ngxUiLoaderService.stopLoader("loader-02")}}),this.recalculate=(0,w.Z)(function*(){i.ngxUiLoaderService.startLoader("loader-02");try{i.loggedUser=i.dataService.getLoggedUser(),i.isClient="Clt"===i.loggedUser?.permission,i.existClient=i.isClient?i.loggedUser:i.dataService.getExistClient(),yield i.contractsService.recalculateContractData(i.existClient?.id),window.location.reload()}catch(d){i.dataService.errorHandling(d)}finally{i.ngxUiLoaderService.stopLoader("loader-02")}}),this.createPayment=function(){var d=(0,w.Z)(function*(p){i.ngxUiLoaderService.startLoader("loader-02");try{if(p.preventDefault(),i.lastContract){const m=i.elementForm.getRawValue(),{clientOpen:_,paymentClientAmount:g,paymentClientNumber:C}=m,f=Number.parseInt(i.lastContract.paymentAmount)||0;if(g>_)return void i.dataService.errorHandling({front:!0,message:"El pago es mayor que el saldo restante, verifique e intente nuevamente."});let v=null;if(!i.paymentImage)return void i.dataService.errorHandling({front:!0,message:"La imagen del pago es obligatoria, verifique e intente nuevamente."});v=yield i.imagesService.createImage({base64:i.paymentImage,type:"payment"});const h=[];i.lastContract?.paymentList.forEach(b=>{const A=JSON.parse(JSON.stringify(b)),Y=h.findIndex(S=>S.paymentDate===A.paymentDate);if(-1===Y)h.push(A);else{const S=h[Y];S.amount=S.amount+A.amount,S.status=S.status?A.status:!S.status,h[Y]=S}});let I=0;h.forEach(b=>{I+=f-b.amount});const y=[];if(g>f||I>0&&g>I){const b=i.paymentIncompleteDays?.length||0;let A=g,Y=C,S=0;for(;A>0;){let M=0;const B=N(i.paymentDays[Y-1+S]).tz().format("DD/MM/YYYY");if(b)if(i.paymentIncompleteDays.includes(B)){let ne=0;h.filter($=>$.paymentDate===B).forEach($=>{ne+=$.amount}),M=f-ne}else M=A<f?A:f;else M=A<f?A:f;y.push({client:i.existClient?.id||"",contract:i.lastContract?.id||"",paymentDate:B,paymentNumber:Y+S,amount:`${M}`,paymentPicture:v?v.id:""}),A-=M,S++}}else{const b=N(i.paymentDays[m.paymentClientNumber-1]);y.push({client:i.existClient?.id||"",contract:i.lastContract?.id||"",paymentDate:b.format("DD/MM/YYYY"),paymentNumber:m.paymentClientNumber,amount:m.paymentClientAmount,paymentPicture:v?v.id:""})}yield i.paymentsService.createPayment(y,{latitude:i.latitude,longitude:i.longitude}),i.isClient?window.location.reload():i.redirect(q.f.routes.contractsPending)}}catch(m){i.dataService.errorHandling(m)}finally{i.ngxUiLoaderService.stopLoader("loader-02")}});return function(p){return d.apply(this,arguments)}}(),this.openImage=d=>{let p="",m="";switch(d){case"client":p="del cliente",m=this.profilePicture;break;case"address":p="de la direcci\xf3n",m=this.addressPicture;break;case"payment":p="del pago",m=this.paymentImage}J().fire({title:`<strong>Foto ${p}</strong>`,html:`<div class="card"><div class="card-body"><img src="${m}" class="card-img-top" alt="..."></div></div>`,showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})},this.openPayments=()=>{if(this.lastContract){const d=Number.parseInt(this.lastContract.paymentAmount)||0;let p='<li class="list-group-item">\n        <div class="row">\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Fecha</b>\n            </p>\n          </div>\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Abonado</b>\n            </p>\n          </div>\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Restante</b>\n            </p>\n          </div>\n          <div class="col-3" style="padding: 0 !important">\n            <p style="text-align: center">\n              <b>Estado</b>\n            </p>\n          </div>\n        </div>\n      </li>';const m=[];this.lastContract?.paymentList.forEach(_=>{const g=JSON.parse(JSON.stringify(_)),C=m.findIndex(f=>f.paymentDate===g.paymentDate);if(-1===C)m.push(g);else{const f=m[C];f.amount=f.amount+g.amount,f.status=f.status?g.status:!f.status,m[C]=f}}),m.forEach(_=>{const g=d-_.amount;p+=`<li class="list-group-item">\n          <div class="row">\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${_.paymentDate}\n              </p>\n            </div>\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${_.amount} R$\n              </p>\n            </div>\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${g<0?0:g} R$\n              </p>\n            </div>\n            <div class="col-3" style="padding: 0 !important">\n              <p style="text-align: center">\n                ${_.status?"Validado":"Pendiente"}\n              </p>\n            </div>\n          </div>\n        </li>`}),J().fire({title:"<strong>Parcelas con abonos</strong>",html:'<div class="card"><div class="card-body"><ul class="list-group list-group-flush">'+p+"</ul></div></div>",showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})}},this.createContract=()=>{this.existClient&&(this.dataService.setCreatedUser(this.existClient),this.redirect(q.f.routes.contractsCreate))},this.goBack=()=>{this.location.back()},this.openCamera=d=>{this.cameraDialogRef=this.matDialog.open(W.M,{autoFocus:!0,disableClose:!0,height:"90vh",minWidth:"95vw"}),this.cameraDialogRef.afterClosed().subscribe(function(){var p=(0,w.Z)(function*(m){m&&"payment"===d&&(i.paymentImage=m),i.cameraDialogRef=null});return function(m){return p.apply(this,arguments)}}())},this.uploadFile=d=>{const p=d.files[0],m=new FileReader;m.addEventListener("load",function(){var _=(0,w.Z)(function*(g){i.selectedFile=new vt(g.target.result,p),i.paymentImage=g.target.result});return function(g){return _.apply(this,arguments)}}()),m.readAsDataURL(p)},this.user=this.dataService.getLoggedUser(),(!this.dataService.getIsLoggedIn()||!this.user)&&(this.dataService.clearLoginData(),this.redirect(q.f.routes.login)),this.setGeolocation()}ngOnInit(){(0,k.qS)(Le.Z),this.titleService.setTitle("SISTEMA IMPERIAL | Detalles del contrato"),this.elementForm=this.createForm(),this.loadData()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(k.K0),e.Y36(H.LA),e.Y36(je.W),e.Y36(Ge),e.Y36(X.C),e.Y36(o.qu),e.Y36(R.D),e.Y36(ee.uw),e.Y36(Q.Dx),e.Y36(k.Ye),e.Y36(L.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-clients-detail"]],decls:21,vars:11,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],[4,"ngIf"],["routerLink","/admin/dashboard",4,"ngIf"],["routerLink","/admin/clients/actives",4,"ngIf"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"col-md-12","stretch-card"],[1,"card"],["name","elementForm","novalidate","",3,"formGroup"],["class","card-header","style","text-align: center;",3,"ngStyle",4,"ngIf"],[1,"card-body"],["class","card-footer",4,"ngIf"],[1,"feather","icon-home"],["routerLink","/admin/dashboard"],["routerLink","/admin/clients/actives"],[1,"card-header",2,"text-align","center",3,"ngStyle"],[1,"card-title","mt-0"],[1,"mb-3"],[1,"col-6",2,"text-align","center"],["alt","...",1,"card-img-top",3,"src","click"],["href","javascript:void(0)","target","_blank",3,"click"],[1,"feather","icon-eye"],["class","d-grid gap-2","style","text-align: right",4,"ngIf"],[1,"d-grid","gap-2",2,"text-align","right"],[1,"btn","btn-primary",3,"click"],[1,"card","card-table"],[1,"col-6",2,"padding","0 !important"],[2,"text-align","center"],[2,"font-size","1.2em"],[1,"col-3",2,"padding","0 !important"],["type","button",1,"btn","btn-primary",3,"click"],[2,"color","green"],[2,"color","orange"],[2,"color","rgb(255, 76, 76)"],["id","calendar",3,"options","events","deepChangeDetection"],["calendar",""],[1,"row","mb-3"],["for","paymentClientNumber",1,"col-5","form-label"],[1,"col-7"],["type","number","id","paymentClientNumber","formControlName","paymentClientNumber","autocomplete","off","required","",1,"form-control",2,"text-align","right"],["for","paymentClientAmount",1,"col-5","form-label"],[1,"input-group"],["placement","bottom","ngbTooltip","Tooltip on bottom",1,"input-group-text","hover"],["type","number","id","paymentClientAmount","formControlName","paymentClientAmount","autocomplete","off","required","",1,"form-control",2,"text-align","right"],["class","col-12","style","text-align: center",4,"ngIf"],[1,"col-8"],["id","formFile","type","file","accept","image/png,image/jpeg","ng2FileSelect","",1,"form-control",3,"uploader","change"],["fileInput",""],[1,"col-4"],[1,"d-grid","gap-2"],["href","","href","javascript:void(0)",1,"btn","btn-primary",3,"click"],[1,"feather","icon-camera"],[1,"col-12","d-grid","gap-2",2,"text-align","center"],[1,"btn","btn-primary",3,"disabled","click"],["class","row",4,"ngIf"],[1,"col-12",2,"text-align","center"],[1,"col-6","d-grid","gap-2",2,"text-align","left"],[1,"col-6","d-grid","gap-2",2,"text-align","right"],[1,"card-footer"],["fxLayout","row","fxLayoutAlign","space-between"],[1,"btn","btn-secondary",3,"click"]],template:function(n,a){1&n&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2),e.YNc(3,Ke,2,0,"a",3),e.YNc(4,We,2,0,"a",4),e.qZA(),e.TgZ(5,"li",2),e.YNc(6,Xe,2,0,"a",3),e.YNc(7,et,2,0,"a",5),e.qZA(),e.TgZ(8,"li",6),e._uU(9,"Detalles del cliente"),e.qZA()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"div",9)(13,"form",10),e.YNc(14,nt,3,3,"div",11),e.TgZ(15,"div",12),e.YNc(16,lt,43,12,"div",3),e.YNc(17,ct,4,1,"div",3),e.YNc(18,mt,4,1,"div",3),e.YNc(19,ft,70,38,"div",3),e.qZA()(),e.YNc(20,ht,5,0,"div",13),e.qZA()()()),2&n&&(e.xp6(3),e.Q6J("ngIf",a.isClient),e.xp6(1),e.Q6J("ngIf",!a.isClient),e.xp6(2),e.Q6J("ngIf",a.isClient),e.xp6(1),e.Q6J("ngIf",!a.isClient),e.xp6(6),e.Q6J("formGroup",a.elementForm),e.xp6(1),e.Q6J("ngIf",a.isClient),e.xp6(2),e.Q6J("ngIf",!a.isClient),e.xp6(1),e.Q6J("ngIf",!a.haveContracts),e.xp6(1),e.Q6J("ngIf",a.haveContracts&&!a.haveActiveContracts),e.xp6(1),e.Q6J("ngIf",a.haveContracts&&a.haveActiveContracts),e.xp6(1),e.Q6J("ngIf",!a.isClient))},dependencies:[L.rH,o._Y,o.Fj,o.wV,o.JJ,o.JL,o.Q7,k.O5,k.PC,P.xw,P.Wh,Oe.Zl,te.C6,K._L,ze.w,o.sg,o.u,k.JJ]}),t})()}];let Ct=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[L.Bz.forChild(_t),o.u5,V.A,o.UX,ie]}),t})()}}]);