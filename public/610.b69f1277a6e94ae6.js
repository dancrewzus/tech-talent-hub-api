"use strict";(self.webpackChunkimperial=self.webpackChunkimperial||[]).push([[610],{6610:(le,A,r)=>{r.r(A),r.d(A,{MovementsModule:()=>oe});var y=r(9562),l=r(5030),h=r(5861),R=r(7317),F=r(5226),_=r.n(F),M=r(6811),Z=r(2534),e=r(2223),U=r(6081),x=r(7066),I=r(3144);let S=(()=>{class t extends x.D{constructor(a){var n;super(),n=this,this.http=a,this.createMovement=function(){var u=(0,h.Z)(function*(s){return n.http.post(`${n.getApiUrl()}/movements`,{...s},{headers:n.getHeaders()}).toPromise()});return function(s){return u.apply(this,arguments)}}(),this.updateUser=function(){var u=(0,h.Z)(function*(s,g){return n.http.patch(`${n.getApiUrl()}/movements/${s}`,{...g},{headers:n.getHeaders()}).toPromise()});return function(s,g){return u.apply(this,arguments)}}(),this.dailyResume=(0,h.Z)(function*(){return n.http.get(`${n.getApiUrl()}/movements/daily-resume`,{headers:n.getHeaders()}).toPromise()})}}return t.\u0275fac=function(a){return new(a||t)(e.Y36(I.eN))},t.\u0275dir=e.lG2({type:t,features:[e.qOj]}),t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var L=r(4074),q=r(5580),w=r(6550),b=r(4755);function Y(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"div",32)(1,"img",33),e.NdJ("click",function(){e.CHM(a);const u=e.oxw();return e.KtG(u.openImage("payment"))}),e.qZA()()}if(2&t){const a=e.oxw();e.xp6(1),e.Q6J("src",a.paymentImage,e.LSH)}}class J{constructor(o,a){this.src=o,this.file=a}}let N=(()=>{class t{constructor(a,n,u,s,g,i,c,T){var m=this;this.ngxUiLoaderService=a,this.movementsService=n,this.imagesService=u,this.dataService=s,this.formBuilder=g,this.matDialog=i,this.titleService=c,this.router=T,this.paymentImage=null,this.uploader=new R.bA({allowedMimeType:["image/png","image/jpg","image/jpeg"],maxFileSize:1048576,autoUpload:!1,isHTML5:!0,url:""}),this.createForm=()=>this.formBuilder.group({type:["",l.kI.required],amount:["",l.kI.required],description:["",l.kI.required]}),this.redirect=(p="")=>{this.router.navigate(""!==p?[`${p}`]:[Z.f.routes.dash])},this.createPayment=function(){var p=(0,h.Z)(function*(v){m.ngxUiLoaderService.startLoader("loader-02");try{v.preventDefault();let d=null;if(!m.paymentImage)return void m.dataService.errorHandling({front:!0,message:"La imagen del movimiento es obligatoria, verifique e intente nuevamente."});d=yield m.imagesService.createImage({base64:m.paymentImage,type:"payment"});const D=m.elementForm.getRawValue(),{type:C,amount:re,description:ie}=D;yield m.movementsService.createMovement({type:C,amount:re,description:ie,paymentPicture:d?.id||""}),m.redirect(Z.f.routes.dash)}catch(d){m.dataService.errorHandling(d)}finally{m.ngxUiLoaderService.stopLoader("loader-02")}});return function(v){return p.apply(this,arguments)}}(),this.openImage=p=>{let v="",d="";"payment"===p&&(v="pago",d=this.paymentImage),_().fire({title:`<strong>Foto del ${v}</strong>`,html:`<div class="card"><div class="card-body"><img src="${d}" class="card-img-top" alt="..."></div></div>`,showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})},this.openCamera=p=>{this.cameraDialogRef=this.matDialog.open(M.M,{autoFocus:!0,disableClose:!0,height:"90vh",minWidth:"95vw"}),this.cameraDialogRef.afterClosed().subscribe(function(){var v=(0,h.Z)(function*(d){d&&"payment"===p&&(m.paymentImage=d),m.cameraDialogRef=null});return function(d){return v.apply(this,arguments)}}())},this.uploadFile=p=>{const v=p.files[0],d=new FileReader;d.addEventListener("load",function(){var D=(0,h.Z)(function*(C){m.selectedFile=new J(C.target.result,v),m.paymentImage=C.target.result});return function(C){return D.apply(this,arguments)}}()),d.readAsDataURL(v)},this.dataService.clearCreatedUser()}ngOnInit(){this.titleService.setTitle("IMPERIAL | Registrar movimiento"),this.elementForm=this.createForm()}}return t.\u0275fac=function(a){return new(a||t)(e.Y36(U.LA),e.Y36(S),e.Y36(L.C),e.Y36(x.D),e.Y36(l.qu),e.Y36(q.uw),e.Y36(w.Dx),e.Y36(y.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-create"]],decls:49,vars:5,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/admin/dashboard"],[1,"feather","icon-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"col-md-12","stretch-card"],[1,"card"],[1,"card-body"],[1,"card-title"],["name","elementForm","novalidate","",3,"formGroup"],[1,"mb-3"],["for","type",1,"form-label"],["id","type","formControlName","type","required","",1,"form-select"],["value","in","selected",""],["value","out"],["for","amount",1,"form-label"],["type","text","id","amount","name","amount","appInputRestriction","float","formControlName","amount","oninput","this.value=this.value.replace(/[^0-9]/g,'')","required","",1,"form-control",2,"text-align","right","padding-right","1em"],["for","description",1,"form-label"],["id","description","formControlName","description","autocomplete","off","required","",1,"form-control"],[1,"row","mb-3"],["class","col-12","style","text-align: center",4,"ngIf"],[1,"col-12"],["id","formFile","type","file","accept","image/png,image/jpeg","ng2FileSelect","",1,"form-control",3,"uploader","change"],["fileInput",""],[1,"d-grid","gap-2"],["href","","href","javascript:void(0)",1,"btn","btn-primary",3,"click"],[1,"feather","icon-camera"],[2,"text-align","center"],["type","submit",1,"btn","btn-primary","me-2",3,"disabled","click"],[1,"btn","btn-secondary",3,"routerLink","click"],[1,"col-12",2,"text-align","center"],["alt","...",1,"card-img-top",3,"src","click"]],template:function(a,n){if(1&a){const u=e.EpF();e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2)(3,"a",3),e._UZ(4,"span",4),e.qZA()(),e.TgZ(5,"li",2),e._uU(6,"Movimientos"),e.qZA(),e.TgZ(7,"li",5),e._uU(8,"Registrar"),e.qZA()()(),e.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"div",9)(13,"h6",10),e._uU(14,"Registrar"),e.qZA(),e.TgZ(15,"form",11)(16,"div",12)(17,"label",13),e._uU(18,"Forma"),e.qZA(),e.TgZ(19,"select",14)(20,"option",15),e._uU(21,"Ingreso"),e.qZA(),e.TgZ(22,"option",16),e._uU(23,"Egreso"),e.qZA()()(),e.TgZ(24,"div",12)(25,"label",17),e._uU(26,"Cantidad"),e.qZA(),e._UZ(27,"input",18),e.qZA(),e.TgZ(28,"div",12)(29,"label",19),e._uU(30,"Descripci\xf3n"),e.qZA(),e._UZ(31,"textarea",20),e.qZA(),e.TgZ(32,"div",21),e.YNc(33,Y,2,1,"div",22),e.qZA(),e.TgZ(34,"div",21)(35,"div",23)(36,"input",24,25),e.NdJ("change",function(){e.CHM(u);const g=e.MAs(37);return e.KtG(n.uploadFile(g))}),e.qZA()()(),e.TgZ(38,"div",21)(39,"div",23)(40,"div",26)(41,"a",27),e.NdJ("click",function(){return n.openCamera("payment")}),e._UZ(42,"span",28),e.qZA()()()(),e._UZ(43,"hr"),e.TgZ(44,"div",29)(45,"button",30),e.NdJ("click",function(g){return n.createPayment(g)}),e._uU(46,"Aceptar"),e.qZA(),e.TgZ(47,"button",31),e.NdJ("click",function(){return!1}),e._uU(48,"Cancelar"),e.qZA()()()()()()()}2&a&&(e.xp6(15),e.Q6J("formGroup",n.elementForm),e.xp6(18),e.Q6J("ngIf",n.paymentImage),e.xp6(3),e.Q6J("uploader",n.uploader),e.xp6(9),e.Q6J("disabled",n.elementForm.invalid),e.xp6(2),e.Q6J("routerLink","/admin/dashboard"))},dependencies:[y.rH,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.Q7,b.O5,R.C6,l.sg,l.u]}),t})();var k=r(6356),B=r(7228),f=r(3627),H=r(2611),Q=r(1576);function $(t,o){1&t&&(e.TgZ(0,"mat-header-cell",28)(1,"span",29),e._uU(2,"Descripci\xf3n"),e.qZA()())}function E(t,o){if(1&t&&(e.TgZ(0,"mat-cell",28)(1,"span",30),e._uU(2),e.qZA()()),2&t){const a=o.$implicit;e.xp6(2),e.Oqu(a.description)}}function j(t,o){1&t&&(e.TgZ(0,"mat-header-cell",31)(1,"span",29),e._uU(2,"Ingresos"),e.qZA()())}function P(t,o){if(1&t&&(e.TgZ(0,"mat-cell",31)(1,"span",32),e._uU(2),e.ALo(3,"number"),e.qZA()()),2&t){const a=o.$implicit;e.xp6(2),e.hij("",e.Dn7(3,1,a.amount,"","es")," R$")}}function O(t,o){1&t&&e._UZ(0,"mat-header-row",33)}function G(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"mat-row",34),e.NdJ("click",function(){const s=e.CHM(a).$implicit,g=e.oxw();return e.KtG(g.openImage(s.paymentPicture))}),e.qZA()}}function K(t,o){1&t&&(e.TgZ(0,"mat-header-cell",28)(1,"span",29),e._uU(2,"Descripci\xf3n"),e.qZA()())}function z(t,o){if(1&t&&(e.TgZ(0,"mat-cell",28)(1,"span",30),e._uU(2),e.qZA()()),2&t){const a=o.$implicit;e.xp6(2),e.Oqu(a.description)}}function X(t,o){1&t&&(e.TgZ(0,"mat-header-cell",31)(1,"span",29),e._uU(2,"Egresos"),e.qZA()())}function W(t,o){if(1&t&&(e.TgZ(0,"mat-cell",31)(1,"span",32),e._uU(2),e.ALo(3,"number"),e.qZA()()),2&t){const a=o.$implicit;e.xp6(2),e.hij("",e.Dn7(3,1,a.amount,"","es")," R$")}}function V(t,o){1&t&&e._UZ(0,"mat-header-row",33)}function ee(t,o){1&t&&e._UZ(0,"mat-row",35)}function te(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(a);const u=e.oxw();return e.KtG(u.blockDailyResume())}),e.TgZ(1,"span"),e._uU(2,"Bloquear"),e.qZA()()}}function ae(t,o){1&t&&(e.TgZ(0,"button",37)(1,"span"),e._uU(2,"Bloqueado"),e.qZA()())}const ne=[{path:"",redirectTo:"create",pathMatch:"full"},{path:"create",component:N},{path:"daily-resume",component:(()=>{class t{constructor(a,n,u,s,g){var i=this;this.ngxUiLoaderService=a,this.movementsService=n,this.dataService=u,this.titleService=s,this.router=g,this.yesterdayAmount=0,this.todayAmount=0,this.movementsFromToday=[],this.closed=!1,this.displayedColumns=["details","amount"],this.displayedColumnsWithImage=["details","amount","image"],this.redirect=(c="")=>{this.router.navigate(""!==c?[`${c}`]:[Z.f.routes.dash])},this.loadData=(0,h.Z)(function*(){i.ngxUiLoaderService.startLoader("loader-02");try{const c=yield i.movementsService.dailyResume();if(c){const{yesterdayAmount:T,todayAmount:m,movementsFromToday:p,closed:v}=c;i.yesterdayAmount=T,i.todayAmount=m,i.closed=v,i.incomesDataSource=new f.by(p.incomesMovementsFromToday),i.expensesDataSource=new f.by(p.expensesMovementsFromToday)}}catch(c){i.dataService.errorHandling(c)}finally{i.ngxUiLoaderService.stopLoader("loader-02")}}),this.blockDailyResume=(0,h.Z)(function*(){_().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Bloquear",cancelButtonText:"Cancelar"}).then(c=>{c.isConfirmed&&i.createFinalMovement()})}),this.createFinalMovement=(0,h.Z)(function*(){try{i.ngxUiLoaderService.startLoader("loader-02"),yield i.movementsService.createMovement({amount:i.todayAmount,type:"final",description:"Cierre de caja",paymentPicture:""}),i.redirect(Z.f.routes.dash)}catch(c){i.dataService.errorHandling(c)}finally{i.ngxUiLoaderService.stopLoader("loader-02")}}),this.openImage=c=>{_().fire({title:"<strong>Imagen</strong>",html:`<div class="card"><div class="card-body"><img src="${c}" class="card-img-top" alt="..."></div></div>`,showCloseButton:!0,showCancelButton:!1,confirmButtonText:"Cerrar",confirmButtonAriaLabel:"close"})},this.user=this.dataService.getLoggedUser(),(!this.dataService.getIsLoggedIn()||!this.user)&&(this.dataService.clearLoginData(),this.redirect(Z.f.routes.login))}ngOnInit(){(0,b.qS)(B.Z),this.titleService.setTitle("IMPERIAL | Resumo do dia"),this.loadData()}}return t.\u0275fac=function(a){return new(a||t)(e.Y36(U.LA),e.Y36(S),e.Y36(x.D),e.Y36(w.Dx),e.Y36(y.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-daily-resume"]],decls:59,vars:20,consts:[[1,"page-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/admin/dashboard"],[1,"feather","icon-home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"col-md-12","stretch-card"],[1,"card","card-table"],[1,"card-body"],[1,"card-title"],[1,"mb-3"],[2,"overflow-x","auto !important"],[1,"table-responsive"],["matSort","",1,"common-table",3,"dataSource"],["table",""],["matColumnDef","details"],["fxFlex","auto 1 200px",4,"matHeaderCellDef"],["fxFlex","auto 1 200px",4,"matCellDef"],["matColumnDef","amount"],["fxFlex","auto 1",4,"matHeaderCellDef"],["fxFlex","auto 1",4,"matCellDef"],["class","grey-400-bg font-weight-600",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","user","matRipple","",3,"click",4,"matRowDef","matRowDefColumns"],["class","user","matRipple","",4,"matRowDef","matRowDefColumns"],[1,"row","p-2","mt-4",2,"position","sticky","width","-webkit-fill-available","bottom","4em","left","1em","right","1em"],["class","btn btn-primary","type","button",3,"click",4,"ngIf"],["class","btn btn-primary","type","button","disabled","",4,"ngIf"],["fxFlex","auto 1 200px"],[2,"margin","0","text-align","center","width","100%"],[2,"margin","0","text-align","left","width","100%"],["fxFlex","auto 1"],[2,"margin","0","text-align","right","width","100%"],[1,"grey-400-bg","font-weight-600"],["matRipple","",1,"user",3,"click"],["matRipple","",1,"user"],["type","button",1,"btn","btn-primary",3,"click"],["type","button","disabled","",1,"btn","btn-primary"]],template:function(a,n){1&a&&(e.TgZ(0,"nav",0)(1,"ol",1)(2,"li",2)(3,"a",3),e._UZ(4,"span",4),e.qZA()(),e.TgZ(5,"li",2),e._uU(6,"Movimientos"),e.qZA(),e.TgZ(7,"li",5),e._uU(8,"Resumen del d\xeda"),e.qZA()()(),e.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"div",9)(13,"h6",10),e._uU(14,"Resumen del d\xeda"),e.qZA(),e.TgZ(15,"div",11)(16,"span")(17,"b"),e._uU(18,"Saldo anterior:"),e.qZA(),e._uU(19),e.ALo(20,"number"),e.qZA(),e._UZ(21,"br"),e.qZA(),e.TgZ(22,"div",12)(23,"div",13)(24,"mat-table",14,15),e.ynx(26,16),e.YNc(27,$,3,0,"mat-header-cell",17),e.YNc(28,E,3,1,"mat-cell",18),e.BQk(),e.ynx(29,19),e.YNc(30,j,3,0,"mat-header-cell",20),e.YNc(31,P,4,5,"mat-cell",21),e.BQk(),e.YNc(32,O,1,0,"mat-header-row",22),e.YNc(33,G,1,0,"mat-row",23),e.qZA()()(),e._UZ(34,"br"),e.TgZ(35,"div",12)(36,"div",13)(37,"mat-table",14,15),e.ynx(39,16),e.YNc(40,K,3,0,"mat-header-cell",17),e.YNc(41,z,3,1,"mat-cell",18),e.BQk(),e.ynx(42,19),e.YNc(43,X,3,0,"mat-header-cell",20),e.YNc(44,W,4,5,"mat-cell",21),e.BQk(),e.YNc(45,V,1,0,"mat-header-row",22),e.YNc(46,ee,1,0,"mat-row",24),e.qZA()()(),e._UZ(47,"br")(48,"br"),e.TgZ(49,"div",11)(50,"span")(51,"b"),e._uU(52,"Saldo del d\xeda:"),e.qZA(),e._uU(53),e.ALo(54,"number"),e.qZA(),e._UZ(55,"br"),e.qZA()()()()(),e.TgZ(56,"div",25),e.YNc(57,te,3,0,"button",26),e.YNc(58,ae,3,0,"button",27),e.qZA()),2&a&&(e.xp6(19),e.hij(" ",e.Dn7(20,12,n.yesterdayAmount,"","es")," R$"),e.xp6(5),e.Q6J("dataSource",n.incomesDataSource),e.xp6(8),e.Q6J("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky","true"),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(4),e.Q6J("dataSource",n.expensesDataSource),e.xp6(8),e.Q6J("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky","true"),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(7),e.hij(" ",e.Dn7(54,16,n.todayAmount,"","es")," R$"),e.xp6(4),e.Q6J("ngIf",!n.closed),e.xp6(1),e.Q6J("ngIf",n.closed))},dependencies:[y.rH,b.O5,H.YE,f.BZ,f.fO,f.as,f.w1,f.Dz,f.nj,f.ge,f.ev,f.XQ,f.Gk,Q.yH,b.JJ],styles:[".ngx-datatable[_ngcontent-%COMP%]   .datatable-footer[_ngcontent-%COMP%]{display:none!important}"]}),t})()}];let oe=(()=>{class t{}return t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[y.Bz.forChild(ne),l.u5,k.A,l.UX]}),t})()}}]);